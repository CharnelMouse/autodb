<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using autodb • autodb</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using autodb">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">autodb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/autodb.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CharnelMouse/autodb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="autodb_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="autodb_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="autodb_files/viz-1.8.2/viz.js"></script><link href="autodb_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="autodb_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using autodb</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CharnelMouse/autodb/blob/v3.0.0/vignettes/autodb.Rmd" class="external-link"><code>vignettes/autodb.Rmd</code></a></small>
      <div class="d-none name"><code>autodb.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://charnelmouse.github.io/autodb/">autodb</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'autodb'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     decompose</span></span></code></pre></div>
<div class="section level2">
<h2 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a>
</h2>
<p>To avoid confusion, this vignette is consistent with terminology: a
<em>database</em> consists of <em>relations</em>, which have
<em>records</em> with the same <em>attributes</em>. This is in line with
terms used in the relational model; in Statistics, we would talk about
tables, which have rows with values for the same variables, with a
column for each variable.</p>
<p>For the original data set, which is a flat table, we refer to a
<em>data frame</em> instead, which also consists of records with
attributes.</p>
<p>When we talk about the type of values an attribute can take, we talk
about a <em>class</em>, as in the relational model and R, rather than a
value type, as in many other programming languages.</p>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p><code>autodb</code> is described in the DESCRIPTION file in the
following way:</p>
<blockquote>
<p>Automatic normalisation of a data frame to third normal form, with
the intention of easing the process of data cleaning. (Usage to design
your actual database for you is not advised.)</p>
</blockquote>
<p>Let us begin there.</p>
<div class="section level3">
<h3 id="for-data-cleaning">For data cleaning<a class="anchor" aria-label="anchor" href="#for-data-cleaning"></a>
</h3>
<p>Database normalisation works on the principle that our data should
only express a piece of information in a single place. This is done to
reduce the chance that a modification will accidentally change or remove
other pieces of information.</p>
<p>Data cleaning works on the principle that we remove duplicate
observations and structural errors, and have a clear understanding of
any associations between different observations, or parts of
observations. This is done to ensure a high quality for the data used in
analysis, but I have found that it is equally important for making sure
that I understand the domain I am hoping to model.</p>
<p>Normalisation is helpful for both of these areas. I usually use the
original, flat, “tidy” data for the analysis itself. However, for
checking the data’s consistency, and for using the data to learn about
the domain, normalised data is often helpful, whether it’s used for the
analysis or not.</p>
<p>I usually do data checking under the following conditions:</p>
<ul>
<li>No need to store the data in normalised form. My own work normally
consists of one-off analyses, where I won’t see the data again once I’ve
finished the work. For more permanent data, it would be better to store
the data in a database designed to hold it, if you’re able to.</li>
<li>Limited documentation. In my own work, I am lucky if I am given a
key or a data dictionary for the data set at all. When I am, it usually
proves to be wrong somehow. This makes it even more important to do data
checking, not just for looking for errors, but also as an exercise in
understanding the problem domain before starting to model it.</li>
<li>Data that fits in local memory. This process could be done in
batches or using a streaming algorithm, but this is a more advanced
case.</li>
</ul>
<p>It’s in this context that I would usually have to do the
normalisation by hand, and I would like to have a tool that does it
semi-automatically. This package is intended to be that tool, using a
minimal amount of additional libraries.</p>
</div>
<div class="section level3">
<h3 id="not-for-database-design">Not for database design<a class="anchor" aria-label="anchor" href="#not-for-database-design"></a>
</h3>
<p>Good database design is a hard and involved process, which requires a
strong grasp on the domain that the database will hold information on.
Please don’t try to use this package to do it on autopilot. In
particular, the conditions described above mean we do things differently
to good practice for normalised relational databases:</p>
<ul>
<li>We need to handle constant attributes, that have the same value in
every record. In a real database, we would probably expect these to not
stay constant when more data is added, and would know which relation to
place it in. In one-off data checking, there isn’t more data coming, so
we need to handle these attributes in an automatic way by placing them
in a “constants” relation with an empty key, which database designers
would probably frown at.</li>
<li>We don’t care about database design principles concerned with
avoiding errors under deletion, modification, and so on, because the
data won’t change. This means that we don’t care about introducing
artificial keys, unless we think it would make data modelling more
convenient. Similarly, we don’t care about having single-attribute
reference relations, which are used to make sure other relations only
assign legal values to that relation’s attribute.</li>
<li>We have no “derived relations”, also known as “views”, which are
additional relations created from the others for lookup convenience. We
expect to be using the data frame for modelling, rather than the
database, so such lookups aren’t commonly necessary, and are left to the
discretion of the user to do manually with base R’s <code>merge</code>
function.</li>
</ul>
</div>
<div class="section level3">
<h3 id="to-third-normal-form">To third normal form<a class="anchor" aria-label="anchor" href="#to-third-normal-form"></a>
</h3>
<p><code>autodb</code> gets a given data frame to third normal form:
every attribute depends on the whole key(s), and non-key attributes
depend on nothing but the key(s). This was chosen because there is an
existing algorithm, Bernstein’s synthesis, for normalising to third
normal form, and because it’s the highest normal form that is attainable
with arbitrary original data frames. There is an additional enhancement
available as an option: see the section on avoidable attributes for more
details.</p>
</div>
</div>
<div class="section level2">
<h2 id="simple-examples">Simple examples<a class="anchor" aria-label="anchor" href="#simple-examples"></a>
</h2>
<p>For most of these simple examples, we use the
<code>ChickWeight</code> dataset, included with base R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="co">#&gt;      weight           Time           Chick     Diet   </span></span>
<span><span class="co">#&gt;  Min.   : 35.0   Min.   : 0.00   13     : 12   1:220  </span></span>
<span><span class="co">#&gt;  1st Qu.: 63.0   1st Qu.: 4.00   9      : 12   2:120  </span></span>
<span><span class="co">#&gt;  Median :103.0   Median :10.00   20     : 12   3:120  </span></span>
<span><span class="co">#&gt;  Mean   :121.8   Mean   :10.72   10     : 12   4:118  </span></span>
<span><span class="co">#&gt;  3rd Qu.:163.8   3rd Qu.:16.00   17     : 12          </span></span>
<span><span class="co">#&gt;  Max.   :373.0   Max.   :21.00   19     : 12          </span></span>
<span><span class="co">#&gt;                                  (Other):506</span></span></code></pre></div>
<div class="section level3">
<h3 id="normalisation-with-autodb">Normalisation with <code>autodb</code><a class="anchor" aria-label="anchor" href="#normalisation-with-autodb"></a>
</h3>
<p>The simplest way to do normalisation is with the <code>autodb</code>
function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="va">db</span></span>
<span><span class="co">#&gt; database with 2 relations</span></span>
<span><span class="co">#&gt; 4 attributes: weight, Time, Chick, Diet</span></span>
<span><span class="co">#&gt; relation Chick: Chick, Diet; 50 records</span></span>
<span><span class="co">#&gt;   key 1: Chick</span></span>
<span><span class="co">#&gt; relation Time_Chick: Time, Chick, weight; 578 records</span></span>
<span><span class="co">#&gt;   key 1: Time, Chick</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; Time_Chick.{Chick} -&gt; Chick.{Chick}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h3>
<p>There is no plotting method within the <code>autodb</code> package
itself. Instead, there are functions to write normalised objects as
inputs to the Graphviz visualisation software, using the DOT
language.</p>
<p>The generic function to do this is <code>gv</code>, which calls the
<code>gv.database</code> method on our database, <code>db</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">db_text</span><span class="op">)</span></span>
<span><span class="co">#&gt; digraph {</span></span>
<span><span class="co">#&gt;   rankdir = "LR"</span></span>
<span><span class="co">#&gt;   node [shape=plaintext];</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   "Chick" [label = &lt;</span></span>
<span><span class="co">#&gt;     &lt;TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD COLSPAN="3"&gt;Chick (50 records)&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD PORT="TO_chick"&gt;Chick&lt;/TD&gt;&lt;TD BGCOLOR="black"&gt;&lt;/TD&gt;&lt;TD PORT="FROM_chick"&gt;ordered&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD PORT="TO_diet"&gt;Diet&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;TD PORT="FROM_diet"&gt;factor&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="co">#&gt;   "Time_Chick" [label = &lt;</span></span>
<span><span class="co">#&gt;     &lt;TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4"&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD COLSPAN="3"&gt;Time_Chick (578 records)&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD PORT="TO_time"&gt;Time&lt;/TD&gt;&lt;TD BGCOLOR="black"&gt;&lt;/TD&gt;&lt;TD PORT="FROM_time"&gt;numeric&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD PORT="TO_chick"&gt;Chick&lt;/TD&gt;&lt;TD BGCOLOR="black"&gt;&lt;/TD&gt;&lt;TD PORT="FROM_chick"&gt;ordered&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;TR&gt;&lt;TD PORT="TO_weight"&gt;weight&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;TD PORT="FROM_weight"&gt;numeric&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="co">#&gt;     &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   "Time_Chick":FROM_chick -&gt; "Chick":TO_chick;</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This can be saved to a file for passing to Graphviz elsewhere, or can
be passed into an R function that renders Graphviz code. This vignette
uses <code>grViz</code> from the <code>DiagrammeR</code> package. If
you’re writing a document in Quarto, you can call GraphViz directly
using the <code>dot</code> engine; this approach avoids loading 2MB of
Javascript for HTML widgets into the rendered file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="va">print</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">maybe_plot</span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Chick (50 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD><\/TD><TD PORT=\"FROM_diet\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"Time_Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Time_Chick (578 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_time\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD><\/TD><TD PORT=\"FROM_weight\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"Time_Chick\":FROM_chick -> \"Chick\":TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Each relation is represented as a box, with the top row giving the
relation name and the number of records, and the other rows detailing
the attributes. In the middle is a grid of cells: each column of cells
represents a (candidate) key for the relation, where attributes in that
key have their cell filled in black.</p>
<p>We can see that <code>ChickWeight</code> was split into two
relations, with a weight for each unique combination of Chick number and
time, and the Chick number by itself determining the diet. We can also
see the number of records in each relation, and the classes of the
attributes in those relations.</p>
<p><code>gv</code> also has methods for <code>data.frame</code>, and for
<code>database_schema</code>, which is introduced later.</p>
</div>
<div class="section level3">
<h3 id="finding-functional-dependencies">Finding functional dependencies<a class="anchor" aria-label="anchor" href="#finding-functional-dependencies"></a>
</h3>
<p>Having looked at the final result first, we now look at the
individual steps. The first step is to find the (non-trivial and
minimal) dependencies present in the given data frame. There are various
ways to do this; by default, the package uses FDHitsSep, a depth-first
search algorithm. We run this using the <code>discover</code> function,
setting <code>progress</code> to <code>TRUE</code> to see the steps
taken:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span><span class="va">ChickWeight</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; formatting numerical/complex variables with 7 significant digits</span></span>
<span><span class="co">#&gt; simplifying data types</span></span>
<span><span class="co">#&gt; calculating single-attribute PLIs</span></span>
<span><span class="co">#&gt; sampling difference sets</span></span>
<span><span class="co">#&gt; 7 initial diffsets</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; dependant weight</span></span>
<span><span class="co">#&gt; dependant Time</span></span>
<span><span class="co">#&gt; dependant Chick</span></span>
<span><span class="co">#&gt; dependant Diet</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FDHitsSep complete</span></span>
<span><span class="co">#&gt; 9 final diffsets</span></span>
<span><span class="co">#&gt; 10 nodes visited</span></span>
<span><span class="co">#&gt; 7 partitions cached</span></span>
<span><span class="va">deps</span></span>
<span><span class="co">#&gt; 2 functional dependencies</span></span>
<span><span class="co">#&gt; 4 attributes: weight, Time, Chick, Diet</span></span>
<span><span class="co">#&gt; Time, Chick -&gt; weight</span></span>
<span><span class="co">#&gt;       Chick -&gt; Diet</span></span></code></pre></div>
<p>After simplifying the data to something quicker to iterate over –
specifically, by converting all attributes to have integer values – the
algorithm takes each attribute in turn as a possible dependant, and
finds sets of the other attributes that determine it.</p>
<p>The result is a list of functional dependencies, in the format
<code>determinant set -&gt; dependant</code>, with an attribute named
<code>attrs_order</code> that gives all the attribute names in their
original order. Each of these three parts has its own (generic)
extraction function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/detset.html">detset</a></span><span class="op">(</span><span class="va">deps</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "Time"  "Chick"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "Chick"</span></span>
<span><span class="fu"><a href="../reference/dependant.html">dependant</a></span><span class="op">(</span><span class="va">deps</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "weight" "Diet"</span></span>
<span><span class="fu"><a href="../reference/attrs_order.html">attrs_order</a></span><span class="op">(</span><span class="va">deps</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "weight" "Time"   "Chick"  "Diet"</span></span></code></pre></div>
<p>The former two, especially, are useful for filtering, as we’ll see
later.</p>
</div>
<div class="section level3">
<h3 id="normalisation">Normalisation<a class="anchor" aria-label="anchor" href="#normalisation"></a>
</h3>
<p>Now that we have a list of discovered dependencies, we can construct
a database schema, where the relation schemas are normalised to third
normal form. This is done using a version of Bernstein’s synthesis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/synthesise.html">synthesise</a></span><span class="op">(</span><span class="va">deps</span><span class="op">)</span></span>
<span><span class="va">schema</span></span>
<span><span class="co">#&gt; 2 relation schemas</span></span>
<span><span class="co">#&gt; 4 attributes: weight, Time, Chick, Diet</span></span>
<span><span class="co">#&gt; schema Chick: Chick, Diet</span></span>
<span><span class="co">#&gt;   key 1: Chick</span></span>
<span><span class="co">#&gt; schema Time_Chick: Time, Chick, weight</span></span>
<span><span class="co">#&gt;   key 1: Time, Chick</span></span></code></pre></div>
<p>Like the database before, we can also plot this database schema:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">maybe_plot</span><span class="op">(</span><span class="va">schema</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT=\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD PORT=\"FROM_diet\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"Time_Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Time_Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD PORT=\"FROM_time\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT=\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD PORT=\"FROM_weight\"><\/TD><\/TR>\n    <\/TABLE>>];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This is similar to the database plot given before, but there is some
information not present, that requires the data frame itself. We do have
class information about the attributes, extracted from the data frame
during dependency discovery, but we have no record counts for the
individual relation schemas. However, we do have automatically-generated
names for the individual relations.</p>
<p>Additionally, at this point we have no connections between the
relation schemas, since Bernstein’s synthesis doesn’t supply information
about foreign key references. We could use this database schema to build
a database, but we’d rather add the foreign key references first.</p>
</div>
<div class="section level3">
<h3 id="tuning-detection-and-normalisation">Tuning detection and normalisation<a class="anchor" aria-label="anchor" href="#tuning-detection-and-normalisation"></a>
</h3>
<p>Let’s look at a different dataset for a moment, to look at some cases
where we don’t want to use the dependencies as given. We’ll use the
Titanic data set, also provided with base R. This data is in array form,
so we first convert it to data frame form:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Class</th>
<th align="left">Sex</th>
<th align="left">Age</th>
<th align="left">Survived</th>
<th align="right">Freq</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">35</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">No</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">118</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">154</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">387</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">670</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">89</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">No</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Male</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Female</td>
<td align="left">Child</td>
<td align="left">Yes</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Male</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">192</td>
</tr>
<tr class="odd">
<td align="left">1st</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">140</td>
</tr>
<tr class="even">
<td align="left">2nd</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">80</td>
</tr>
<tr class="odd">
<td align="left">3rd</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">76</td>
</tr>
<tr class="even">
<td align="left">Crew</td>
<td align="left">Female</td>
<td align="left">Adult</td>
<td align="left">Yes</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>This is a simple set of data, with a single count observation,
<code>Freq</code>, for each combination of the four determining
attributes. In other words, the relation is already normalised, so we
only expect one relation in the normalised database.</p>
<p>If we use <code>autodb</code> again, we get the following
database:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Class_Survived_Freq\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Class_Survived_Freq (28 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_class\">Class<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_class\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"Sex_Survived_Freq\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Sex_Survived_Freq (28 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sex\">Sex<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_sex\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"Class_Sex_Age_Survived\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Class_Sex_Age_Survived (32 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_class\">Class<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_class\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sex\">Sex<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_sex\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"Class_Sex_Age_Survived\":FROM_class -> \"Class_Survived_Freq\":TO_class;\n  \"Class_Sex_Age_Survived\":FROM_survived -> \"Class_Survived_Freq\":TO_survived;\n  \"Class_Sex_Age_Survived\":FROM_freq -> \"Class_Survived_Freq\":TO_freq;\n  \"Class_Sex_Age_Survived\":FROM_sex -> \"Sex_Survived_Freq\":TO_sex;\n  \"Class_Sex_Age_Survived\":FROM_survived -> \"Sex_Survived_Freq\":TO_survived;\n  \"Class_Sex_Age_Survived\":FROM_freq -> \"Sex_Survived_Freq\":TO_freq;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Oops! The search found some functional dependencies where the count
could be used to determine another attribute. These are clearly
spurious: frequency count can’t causally determine age, for example.
However, the algorithm still finds these dependencies, because the
counts are unique often enough to make these dependencies hold in the
given data.</p>
<p>There are two approaches we can take to eliminate these spurious
dependencies: not letting them be detected in the first place, and
removing them before using <code>synthesise</code>.</p>
<p>To stop them being detected, we can put constraints on what is
discovered by <code>discover</code>: we can ask for certain attributes
to not be considered as determinants, or we can exclude attributes that
inherit from certain classes. In this example, we could exclude
<code>Freq</code> from being considered:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titanic_deps_freqonly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span>, exclude <span class="op">=</span> <span class="st">"Freq"</span><span class="op">)</span></span>
<span><span class="va">titanic_deps_freqonly</span></span>
<span><span class="co">#&gt; 1 functional dependency</span></span>
<span><span class="co">#&gt; 5 attributes: Class, Sex, Age, Survived, Freq</span></span>
<span><span class="co">#&gt; Class, Sex, Age, Survived -&gt; Freq</span></span></code></pre></div>
<p>Alternatively, we could exclude all attributes that inherit from
“numeric”:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">titanic_deps_freqonly</span>, <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span>, exclude_class <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>These can both be used as arguments to <code>autodb</code> too:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span>, exclude <span class="op">=</span> <span class="st">"Freq"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Class_Sex_Age_Survived\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Class_Sex_Age_Survived (32 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_class\">Class<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_class\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sex\">Sex<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_sex\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_age\">Age<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_age\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_survived\">Survived<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_survived\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_freq\">Freq<\/TD><TD><\/TD><TD PORT=\"FROM_freq\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Generally, excluding numeric attributes as determinants is often
useful, because we expect non-integer numbers to be a measurement, not
part of a primary key.</p>
<p>Alternatively, we could remove unwanted dependencies before using
<code>decompose</code>. Here are the found dependencies, if we don’t
exclude anything:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titanic_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">titanic_deps</span></span>
<span><span class="co">#&gt; 3 functional dependencies</span></span>
<span><span class="co">#&gt; 5 attributes: Class, Sex, Age, Survived, Freq</span></span>
<span><span class="co">#&gt;       Sex, Survived, Freq -&gt; Age</span></span>
<span><span class="co">#&gt;     Class, Survived, Freq -&gt; Age</span></span>
<span><span class="co">#&gt; Class, Sex, Age, Survived -&gt; Freq</span></span></code></pre></div>
<p>We can remove the unwanted dependencies, where <code>Age</code> is
the dependant:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">titanic_deps</span><span class="op">[</span><span class="fu"><a href="../reference/dependant.html">dependant</a></span><span class="op">(</span><span class="va">titanic_deps</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Freq"</span><span class="op">]</span></span>
<span><span class="co">#&gt; 1 functional dependency</span></span>
<span><span class="co">#&gt; 5 attributes: Class, Sex, Age, Survived, Freq</span></span>
<span><span class="co">#&gt; Class, Sex, Age, Survived -&gt; Freq</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-foreign-key-references">Adding foreign key references<a class="anchor" aria-label="anchor" href="#adding-foreign-key-references"></a>
</h3>
<p>Getting back to our <code>ChickWeight</code> example, we now have a
database schema, consisting of a list of <code>relation</code> schemas.
However, we have no information about how these relation schemas are
linked to each other. In particular, we have no information about
foreign keys. We can add this information using
<code>autoref</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linked_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autoref.html">autoref</a></span><span class="op">(</span><span class="va">schema</span><span class="op">)</span></span>
<span><span class="va">linked_schema</span></span>
<span><span class="co">#&gt; database schema with 2 relation schemas</span></span>
<span><span class="co">#&gt; 4 attributes: weight, Time, Chick, Diet</span></span>
<span><span class="co">#&gt; schema Chick: Chick, Diet</span></span>
<span><span class="co">#&gt;   key 1: Chick</span></span>
<span><span class="co">#&gt; schema Time_Chick: Time, Chick, weight</span></span>
<span><span class="co">#&gt;   key 1: Time, Chick</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; Time_Chick.{Chick} -&gt; Chick.{Chick}</span></span></code></pre></div>
<p>We could also have used <code>normalise</code>, instead of
<code>synthesise</code> and <code>autoref</code> separately:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">deps</span><span class="op">)</span></span>
<span><span class="co">#&gt; database schema with 2 relation schemas</span></span>
<span><span class="co">#&gt; 4 attributes: weight, Time, Chick, Diet</span></span>
<span><span class="co">#&gt; schema Chick: Chick, Diet</span></span>
<span><span class="co">#&gt;   key 1: Chick</span></span>
<span><span class="co">#&gt; schema Time_Chick: Time, Chick, weight</span></span>
<span><span class="co">#&gt;   key 1: Time, Chick</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; Time_Chick.{Chick} -&gt; Chick.{Chick}</span></span></code></pre></div>
<p>Plotting this updated database schema shows the same relation schemas
as before, linked together by foreign key references:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">linked_schema</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-1fb4450895fe099f74a1" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT=\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD PORT=\"FROM_diet\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"Time_Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">Time_Chick<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD PORT=\"FROM_time\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD PORT=\"FROM_chick\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD PORT=\"FROM_weight\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"Time_Chick\":FROM_chick -> \"Chick\":TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="decomposing-the-original-relation">Decomposing the original relation<a class="anchor" aria-label="anchor" href="#decomposing-the-original-relation"></a>
</h3>
<p>Finally, once we have our normalised database schema, we can apply it
to our original data frame, or a new one with the same structure. This
results in a normalised database, as we got from using
<code>autodb</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">ChickWeight</span>, <span class="va">linked_schema</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db2</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-10b3b7155e8045a1b2ad" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Chick (50 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD><\/TD><TD PORT=\"FROM_diet\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"Time_Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Time_Chick (578 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_time\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD><\/TD><TD PORT=\"FROM_weight\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"Time_Chick\":FROM_chick -> \"Chick\":TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We now have the record counts added.</p>
</div>
<div class="section level3">
<h3 id="rejoining-a-database-back-into-a-data-frame">Rejoining a database back into a data frame<a class="anchor" aria-label="anchor" href="#rejoining-a-database-back-into-a-data-frame"></a>
</h3>
<p>We can reverse the process of turning a data frame into a database
with the <code>rejoin</code> function. This may not be identical to
<code>ChickWeight</code>, since the rows may have been rearranged.
However, we can use the convenience function <code>df_equiv</code> to
check for equivalence under row reordering:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rejoined</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rejoin.html">rejoin</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rejoined</span><span class="op">)</span></span>
<span><span class="co">#&gt;      weight           Time           Chick     Diet   </span></span>
<span><span class="co">#&gt;  Min.   : 35.0   Min.   : 0.00   13     : 12   1:220  </span></span>
<span><span class="co">#&gt;  1st Qu.: 63.0   1st Qu.: 4.00   9      : 12   2:120  </span></span>
<span><span class="co">#&gt;  Median :103.0   Median :10.00   20     : 12   3:120  </span></span>
<span><span class="co">#&gt;  Mean   :121.8   Mean   :10.72   10     : 12   4:118  </span></span>
<span><span class="co">#&gt;  3rd Qu.:163.8   3rd Qu.:16.00   17     : 12          </span></span>
<span><span class="co">#&gt;  Max.   :373.0   Max.   :21.00   19     : 12          </span></span>
<span><span class="co">#&gt;                                  (Other):506</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">rejoined</span>, <span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="../reference/df_equiv.html">df_equiv</a></span><span class="op">(</span><span class="va">rejoined</span>, <span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>When rejoined, the relation attributes will be in the original order.
However, the record order might have changed.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-larger-example">A larger example<a class="anchor" aria-label="anchor" href="#a-larger-example"></a>
</h2>
<p>Included in the package is a 447-by-25 data frame called
<code>nudge</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">nudge</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-4018eef1a407a0df6b52" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-4018eef1a407a0df6b52">{"x":{"diagram":"digraph \"data\" {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"data\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">data (447 rows)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This is the data set for a meta-analysis, looking at the
effectiveness of “nudge” interventions. Measurements are taken within a
three-layer hierarchy: publications contain studies, which contain
effect size measurements. We expect this hierarchy to be apparent in the
normalisation.</p>
<div class="section level3">
<h3 id="initial-decomposition">Initial decomposition<a class="anchor" aria-label="anchor" href="#initial-decomposition"></a>
</h3>
<p>Getting full dependency information for this relation can take a long
time, so here we search for a reduced set, not considering numeric or
sample size attributes as determinants:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge</span>,</span>
<span>  exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_study"</span>, <span class="st">"n_comparison"</span>, <span class="st">"n_control"</span>, <span class="st">"n_intervention"</span><span class="op">)</span>,</span>
<span>  exclude_class <span class="op">=</span> <span class="st">"numeric"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nudge_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">nudge_deps</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-5b1b2f4ad92281566982" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-5b1b2f4ad92281566982">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_location\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_location<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_domain\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_domain<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference_binary_outcome\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_binary_outcome<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"reference_type_experiment\":FROM_reference -> \"reference\":TO_reference;\n  \"publication_id_location\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_location\":FROM_reference -> \"title\":TO_reference;\n  \"publication_id_domain\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_domain\":FROM_reference -> \"title\":TO_reference;\n  \"publication_id_intervention_technique\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_intervention_technique\":FROM_reference -> \"title\":TO_reference;\n  \"publication_id_type_experiment\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_type_experiment\":FROM_reference -> \"title\":TO_reference;\n  \"reference_binary_outcome\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"reference_binary_outcome\":FROM_reference -> \"title\":TO_reference;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"publication_id_intervention_technique\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_publication_id -> \"publication_id_domain\":TO_publication_id;\n  \"study_id\":FROM_domain -> \"publication_id_domain\":TO_domain;\n  \"study_id\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"study_id\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n  \"publication_id_type_experiment\":FROM_reference -> \"reference_type_experiment\":TO_reference;\n  \"publication_id_type_experiment\":FROM_type_experiment -> \"reference_type_experiment\":TO_type_experiment;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We can see a relation, with many attributes, determined by the effect
size ID number, <code>es_id</code>. This contains all of the numeric
measurements, as expected in the relation for the lowest level in the
hierarchy. As also expected, this has a foreign key reference to a
relation for study-level information, determined by the study ID number,
<code>study_id</code>.</p>
<p>However, the publication-level relation this refers to is not
determined by the publication ID, <code>publication_id</code>, as we
would expect; neither is it determined by the publication reference.
Instead, it is solely determined by the publication’s title: to use the
ID, we would need to supplement it with other information, like the
publication year, or other choices that come from the middle column of
relations, which look likely to be spurious.</p>
<p>This suggests that some publication ID numbers have been erroneously
assigned to several publications, which we can easily test:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_database</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">nudge</span>, <span class="va">nudge_schema</span><span class="op">)</span></span>
<span><span class="va">nudge_title_relation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">nudge_database</span><span class="op">)</span><span class="op">$</span><span class="va">title</span></span>
<span><span class="va">nudge_pid_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">publication_id</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">publication_id</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">nudge_title_relation</span>, <span class="va">publication_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">nudge_pid_duplicates</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="3%">
<col width="62%">
<col width="12%">
<col width="17%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">title</th>
<th align="right">publication_id</th>
<th align="left">reference</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">44</td>
<td align="left">Enhanced active choice: A new method to motivate
behavior change</td>
<td align="right">95</td>
<td align="left">Keller et al. (2011)</td>
<td align="right">2011</td>
</tr>
<tr class="even">
<td align="left">130</td>
<td align="left">Nudging product choices: The effect of position change
on snack bar choice</td>
<td align="right">95</td>
<td align="left">Keller et al. (2015)</td>
<td align="right">2015</td>
</tr>
</tbody>
</table>
<p>We’d also expect <code>reference</code> to determine the publication,
but this is also not the case: it needs additional information, such as
<code>binary_outcome</code>.</p>
<p>This means that there are publications that share a reference:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_reference_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">reference</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">reference</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">nudge_title_relation</span>, <span class="va">reference</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">nudge_reference_duplicates</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="72%">
<col width="11%">
<col width="9%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">title</th>
<th align="right">publication_id</th>
<th align="left">reference</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">214</td>
<td align="left">Nudge vs superbugs: A behavioural economics trial to
reduce the overprescribing of antibiotics</td>
<td align="right">18</td>
<td align="left">BETA (2018)</td>
<td align="right">2018</td>
</tr>
<tr class="even">
<td align="left">399</td>
<td align="left">Energy labels that make cents</td>
<td align="right">19</td>
<td align="left">BETA (2018)</td>
<td align="right">2018</td>
</tr>
</tbody>
</table>
<p>BETA is the Behavioural Economics Team of the Australian Government,
so it’s not surprising that they’d have multiple publications/reports
per year. Duplicate references is not necessarily an error, but would be
awkward if the references were to be used.</p>
<p>There are other, clearly spurious, relations involving
<code>reference</code>. One of these combines it with
<code>type_experiment</code> to determine <code>location</code>. Since
<code>reference</code> is a publication-level attribute, and
<code>location</code> is a study-level attribute, this can’t be
right.</p>
<p>(As far as I’m aware, the publication ID and reference errors
mentioned above would not have affected the meta-analysis results.)</p>
</div>
<div class="section level3">
<h3 id="removing-spurious-structure">Removing spurious structure<a class="anchor" aria-label="anchor" href="#removing-spurious-structure"></a>
</h3>
<p>The publication ID and the reference clearly have issues, so we need
to decide what to do about them. Here, I’ll show what is usually the
correct approach, which is to remove the spurious functional
dependencies. We’ll look at the other options later.</p>
<p>The better option is to remove all functional dependencies that we’d
consider to be spurious: those where publication ID or reference are
part of a multiple-attribute determinant set, and the determinant set
isn’t just those two:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps_filtered</span> <span class="op">&lt;-</span> <span class="va">nudge_deps</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="../reference/detset.html">detset</a></span><span class="op">(</span><span class="va">nudge_deps</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/detset.html">detset</a></span><span class="op">(</span><span class="va">nudge_deps</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">ds</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">ds</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"publication_id"</span>, <span class="st">"reference"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="va">nudge_schema_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">nudge_deps_filtered</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema_filtered</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-25c3e940e6859592f801" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-25c3e940e6859592f801">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_title -> \"title_type_experiment\":TO_title;\n  \"study_id\":FROM_type_experiment -> \"title_type_experiment\":TO_type_experiment;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We now, finally, have the study location in a non-spurious relation.
If we want to, we could also add the dependencies we fail to find, due
to excluding the sample size attributes from determinant sets:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span><span class="va">nudge</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge</span><span class="op">)</span>, <span class="st">"n_"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">nudge_deps_size</span></span>
<span><span class="co">#&gt; 3 functional dependencies</span></span>
<span><span class="co">#&gt; 4 attributes: n_study, n_comparison, n_control, n_intervention</span></span>
<span><span class="co">#&gt;    n_control, n_intervention -&gt; n_comparison</span></span>
<span><span class="co">#&gt; n_comparison, n_intervention -&gt; n_control</span></span>
<span><span class="co">#&gt;      n_comparison, n_control -&gt; n_intervention</span></span>
<span><span class="va">nudge_deps_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nudge_deps_filtered</span>, <span class="va">nudge_deps_size</span><span class="op">)</span></span>
<span><span class="va">nudge_schema_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">nudge_deps_final</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nudge_database_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">nudge</span>, <span class="va">nudge_schema_final</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema_final</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-3f27c09be0c60bb52829" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-3f27c09be0c60bb52829">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"n_comparison_n_control\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">n_comparison_n_control<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_n_control\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_intervention\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_title -> \"title_type_experiment\":TO_title;\n  \"study_id\":FROM_type_experiment -> \"title_type_experiment\":TO_type_experiment;\n  \"es_id\":FROM_n_comparison -> \"n_comparison_n_control\":TO_n_comparison;\n  \"es_id\":FROM_n_control -> \"n_comparison_n_control\":TO_n_control;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The new schema confirms what we might expect, that the total sample
size, and the sizes of control and treatment arms, only have two degrees
of freedom: knowing two of them determines the other.</p>
<p>We’d expect this to be because the total sample size is the sum of
the other two. However, the functional dependency can’t determine this.
Indeed, if we check for this more specific condition, we find that it
doesn’t hold:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge</span>,</span>
<span>  <span class="va">n_comparison</span> <span class="op">!=</span> <span class="va">n_control</span> <span class="op">+</span> <span class="va">n_intervention</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">es_id</span>,</span>
<span>    <span class="va">reference</span>,</span>
<span>    <span class="va">title</span>,</span>
<span>    <span class="va">n_study</span>,</span>
<span>    <span class="va">n_comparison</span>,</span>
<span>    <span class="va">n_control</span>,</span>
<span>    <span class="va">n_intervention</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="4%">
<col width="16%">
<col width="46%">
<col width="5%">
<col width="8%">
<col width="6%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">es_id</th>
<th align="left">reference</th>
<th align="left">title</th>
<th align="right">n_study</th>
<th align="right">n_comparison</th>
<th align="right">n_control</th>
<th align="right">n_intervention</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">237</td>
<td align="right">180</td>
<td align="left">Hedlin &amp; Sunstein (2016)</td>
<td align="left">Does active choosing promote green energy use?
Experimental evidence</td>
<td align="right">1037</td>
<td align="right">1037</td>
<td align="right">345</td>
<td align="right">346</td>
</tr>
<tr class="even">
<td align="left">302</td>
<td align="right">181</td>
<td align="left">Hedlin &amp; Sunstein (2016)</td>
<td align="left">Does active choosing promote green energy use?
Experimental evidence</td>
<td align="right">1037</td>
<td align="right">1037</td>
<td align="right">345</td>
<td align="right">346</td>
</tr>
</tbody>
</table>
<p>Looking through the paper, the arm sample sizes aren’t given
explicitly, but the numbers here are consistent with the parts of the
study that have two treatments.</p>
<p>Automatic search for functional dependencies cannot check
domain-specific constraints like the summation constraint above, but it
can give schemas that suggest constraints to check for, such as the
two-degrees relation above.</p>
<p>Going back to the final database schema, removing dependencies has
revealed extra information about study locations, via the new
<code>title_type_experiment</code> relation: studies of the same
experiment type in a publication always have the same location. Looking
at the resulting database shows that this removes many entries of what
would be redundant location information if kept in the study
relation:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_database_final</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-416566eb193bf50d04e6" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-416566eb193bf50d04e6">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">study_id (334 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD><\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">es_id (447 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD><\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD><\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD><\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD><\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">reference (212 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">title (213 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">intervention_technique (9 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title_type_experiment (231 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"n_comparison_n_control\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"5\">n_comparison_n_control (346 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_title -> \"title_type_experiment\":TO_title;\n  \"study_id\":FROM_type_experiment -> \"title_type_experiment\":TO_type_experiment;\n  \"es_id\":FROM_n_comparison -> \"n_comparison_n_control\":TO_n_comparison;\n  \"es_id\":FROM_n_control -> \"n_comparison_n_control\":TO_n_control;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>While this is not a dependency we could expect to hold if more data
was collected, it’s a reasonable dependency for the given data set,
which won’t be added to.</p>
</div>
<div class="section level3">
<h3 id="how-not-to-remove-spurious-structure">How not to remove spurious structure<a class="anchor" aria-label="anchor" href="#how-not-to-remove-spurious-structure"></a>
</h3>
<p>The additional relation mentioned at the end of the previous section
is also notable for what we’ll now discuss: alternative ways to get rid
of spurious structure. How can we do this?</p>
<ul>
<li>Remove the offending functional dependencies, and re-do the schema
creation (the proper method);</li>
<li>Remove offending attributes from the table –
e.g. <code>publication_id</code> above, since it doesn’t do its intended
job of unique publication identification – and re-do the entire process
(re-running <code>discover</code> can be expensive; we don’t always want
to throw out everything to do with an attribute,
e.g. <code>reference -&gt; year</code>, or
<code>title -&gt; reference</code>);</li>
<li>Add offending attributes to <code>exclude</code>, to disallow them
in determinant sets, and re-do the entire process (same issues as above,
except that we keep <code>title -&gt; reference</code>, since an
excluded <code>reference</code> can still be a dependant);</li>
<li>Remove offending schemas from the database schema / database (see
below).</li>
</ul>
<p>What happens if we remove the offending schemas?</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_schema_relfiltered</span> <span class="op">&lt;-</span> <span class="va">nudge_schema</span><span class="op">[</span></span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"publication_id_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_publication_id"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"reference_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_reference"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>Subsetting a database schema also removes any foreign key references
involving removed schemas, so the resulting schema is still valid.
However, any foreign key reference chains with removed schemas in the
middle are broken. Amongst others, in this case we lose the reference
between the three relations for the three hierarchical data levels:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema_relfiltered</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-72cbf064100ce560a04c" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-72cbf064100ce560a04c">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Re-running <code>autoref</code> has no effect, because the
<code>es_id</code> section doesn’t contain any key for the
<code>title</code> section:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/autoref.html">autoref</a></span><span class="op">(</span><span class="va">nudge_schema_relfiltered</span><span class="op">)</span>, <span class="va">nudge_schema_relfiltered</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Because the database subschema including the <code>es_id</code>
relation only has <code>publication_id</code> for distinguishing
publications, effect sizes for the two publications with the same ID
cannot be uniquely associated with their publication: removing schemas
irreversibly separates two parts of the database schema.</p>
<p>Furthermore, compared to <code>nudge_schema_filtered</code>, there is
a relation schema missing: directly removing schemas loses the structure
information that results in the <code>title_type_experiment</code>
relation. How does this happen?</p>
<p>The relation isn’t present in the original schema,
<code>nudge_schema_filtered</code>, because the full set of functional
dependencies make its implied dependency transitive. Specifically,
<code>nudge_fds</code> contains the following functional
dependencies:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_fds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"reference"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reference"</span>, <span class="st">"type_experiment"</span><span class="op">)</span>, <span class="st">"location"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"type_experiment"</span><span class="op">)</span>, <span class="st">"location"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"reference"</span>, <span class="st">"type_experiment"</span>, <span class="st">"location"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">example_fds</span></span>
<span><span class="co">#&gt; 3 functional dependencies</span></span>
<span><span class="co">#&gt; 4 attributes: title, reference, type_experiment, location</span></span>
<span><span class="co">#&gt;                      title -&gt; reference</span></span>
<span><span class="co">#&gt; reference, type_experiment -&gt; location</span></span>
<span><span class="co">#&gt;     title, type_experiment -&gt; location</span></span></code></pre></div>
<p>The first two dependencies make the third transitive, so it’s ignored
when constructing the relation schemas: it’s implied, and enforced, by
the <code>title</code> and <code>reference_type_experiment</code>
relation schemas.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">example_fds</span>, ensure_lossless <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-d11fc4360aa0230696d7" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-d11fc4360aa0230696d7">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>However, when <code>reference, type_experiment -&gt; location</code>
is removed as spurious,
<code>title, type_experiment -&gt; location</code> is no longer
transitive, so it now appears as its own relation schema.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">example_fds</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span>, ensure_lossless <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">example_fds</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span>, ensure_lossless <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-21c7483268bafca56cec" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-21c7483268bafca56cec">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>When we instead remove the <code>reference_type_experiment</code>
schema, this implicitly also throws away the
<code>title, type_experiment -&gt; location</code> dependency that it
co-implies. We throw away non-spurious information that we don’t intend
to.</p>
<p>Between the risk of irreversibly breaking the database schema’s
structure, and the risk of unintentionally removing additional structure
information, I hope it’s clear why directly removing relations should be
avoided.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-features">Other features<a class="anchor" aria-label="anchor" href="#other-features"></a>
</h2>
<div class="section level3">
<h3 id="approximate-dependencies-and-database-reduction">Approximate dependencies and database reduction<a class="anchor" aria-label="anchor" href="#approximate-dependencies-and-database-reduction"></a>
</h3>
<p>Larger datasets can often have entry errors, without an easy way to
remove or deal with them. For this reason, we might be interested in
“approximate” functional dependencies, which hold after removing a
bounded amount of violating records.</p>
<p>Suppose that we normalise <code>nudge</code> again, without any
manual dependency removal, but allowing approximate dependencies. We
could cheat, knowing that the questionable data example found above
showed there to be two questionable records: one for a duplicated
publication ID, and one for a duplicated reference. Since
<code>nudge</code> has 447 records, we can get rid of the resulting
questionable dependencies by setting the accuracy to allow two
discrepant records.</p>
<p>The <code>accuracy</code> argument for <code>discover</code> expects
a number between zero and one, determining what proportion of a data
frame’s records need to satisfy a given dependency for the algorithm to
consider it valid. By default, it’s equal to one, so only exact
dependencies are returned. If we set it to less than one, we need to use
the slower DFD search algorithm, since approximate dependency search is
not implemented for the default FDHitsSep algorithm.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge</span>,</span>
<span>  accuracy <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nudge</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"DFD"</span>,</span>
<span>  exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_study"</span>, <span class="st">"n_comparison"</span>, <span class="st">"n_control"</span>, <span class="st">"n_intervention"</span><span class="op">)</span>,</span>
<span>  exclude_class <span class="op">=</span> <span class="st">"numeric"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-1834a22cd196f3aa03a1" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1834a22cd196f3aa03a1">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"publication_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">publication_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_intervention_category_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_intervention_category_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"publication_id_type_experiment\":FROM_publication_id -> \"publication_id\":TO_publication_id;\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"study_id\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n  \"publication_id_intervention_category_type_experiment\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"publication_id_intervention_category_type_experiment\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Currently <code>decompose</code> doesn’t account for approximate
dependencies, resulting in invalid databases, so here we just work with
the database schema.</p>
<p>Compare this to the database schema we arrived at manually:</p>
<ul>
<li>The publication ID, the title, and the reference are considered
equivalent, as we’d have originally expected.</li>
<li>There is an additional relation, showing <code>approximation</code>
to be approximately determined by some publication- and study-level
attributes, rather than functionally determined at the effect-size
level.</li>
</ul>
<p>Lowering the accuracy results in more dependencies being found, and
so in more relations. The number of relations can get very large. For
example, suppose we instead set the accuracy to <code>0.99</code>,
returning any approximate dependencies that hold in at least 443
records.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_approx_database_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge</span>,</span>
<span>  accuracy <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"DFD"</span>,</span>
<span>  exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_study"</span>, <span class="st">"n_comparison"</span>, <span class="st">"n_control"</span>, <span class="st">"n_intervention"</span><span class="op">)</span>,</span>
<span>  exclude_class <span class="op">=</span> <span class="st">"numeric"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_approx_database_schema</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-28515d92cb327f90c9eb" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-28515d92cb327f90c9eb">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"publication_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">publication_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_domain\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_domain<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_domain_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_domain_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_domain_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_domain_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_intervention_category_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_intervention_category_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_intervention_technique_binary_outcome\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_intervention_technique_binary_outcome<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_type_experiment_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_type_experiment_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_intervention_technique_type_experiment_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_intervention_technique_type_experiment_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_intervention_technique_binary_outcome_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_intervention_technique_binary_outcome_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_domain_intervention_category_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_domain_intervention_category_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_domain_intervention_technique_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_domain_intervention_technique_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_intervention_technique_population_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_intervention_technique_population_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_intervention_category_population_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_intervention_category_population_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_intervention_category_binary_outcome_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_intervention_category_binary_outcome_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_domain_intervention_technique_type_experiment_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_domain_intervention_technique_type_experiment_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_domain_intervention_category_binary_outcome_wansink\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_domain_intervention_category_binary_outcome_wansink<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"publication_id_domain\":FROM_publication_id -> \"publication_id\":TO_publication_id;\n  \"publication_id_type_experiment\":FROM_publication_id -> \"publication_id\":TO_publication_id;\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"year_domain_intervention_technique\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"year_intervention_technique_type_experiment_approximation\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"year_intervention_technique_binary_outcome_approximation\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"year_location_intervention_technique_population_approximation\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_publication_id -> \"publication_id_domain\":TO_publication_id;\n  \"study_id\":FROM_domain -> \"publication_id_domain\":TO_domain;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_publication_id -> \"publication_id_domain\":TO_publication_id;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_domain -> \"publication_id_domain\":TO_domain;\n  \"study_id\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"study_id\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n  \"year_domain_intervention_technique_binary_outcome\":FROM_year -> \"year_domain_intervention_technique\":TO_year;\n  \"year_domain_intervention_technique_binary_outcome\":FROM_domain -> \"year_domain_intervention_technique\":TO_domain;\n  \"year_domain_intervention_technique_binary_outcome\":FROM_intervention_technique -> \"year_domain_intervention_technique\":TO_intervention_technique;\n  \"year_location_domain_intervention_technique_approximation\":FROM_year -> \"year_domain_intervention_technique\":TO_year;\n  \"year_location_domain_intervention_technique_approximation\":FROM_domain -> \"year_domain_intervention_technique\":TO_domain;\n  \"year_location_domain_intervention_technique_approximation\":FROM_intervention_technique -> \"year_domain_intervention_technique\":TO_intervention_technique;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_year -> \"year_domain_intervention_technique\":TO_year;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_domain -> \"year_domain_intervention_technique\":TO_domain;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_intervention_technique -> \"year_domain_intervention_technique\":TO_intervention_technique;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_year -> \"year_location_domain_type_experiment\":TO_year;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_location -> \"year_location_domain_type_experiment\":TO_location;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_domain -> \"year_location_domain_type_experiment\":TO_domain;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_type_experiment -> \"year_location_domain_type_experiment\":TO_type_experiment;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_year -> \"year_location_domain_type_experiment\":TO_year;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_location -> \"year_location_domain_type_experiment\":TO_location;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_domain -> \"year_location_domain_type_experiment\":TO_domain;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_type_experiment -> \"year_location_domain_type_experiment\":TO_type_experiment;\n  \"year_location_domain_intervention_technique_approximation\":FROM_year -> \"year_location_domain_approximation\":TO_year;\n  \"year_location_domain_intervention_technique_approximation\":FROM_location -> \"year_location_domain_approximation\":TO_location;\n  \"year_location_domain_intervention_technique_approximation\":FROM_domain -> \"year_location_domain_approximation\":TO_domain;\n  \"year_location_domain_intervention_technique_approximation\":FROM_approximation -> \"year_location_domain_approximation\":TO_approximation;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_year -> \"year_domain_intervention_category_type_experiment\":TO_year;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_domain -> \"year_domain_intervention_category_type_experiment\":TO_domain;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_intervention_category -> \"year_domain_intervention_category_type_experiment\":TO_intervention_category;\n  \"year_location_domain_intervention_category_type_experiment\":FROM_type_experiment -> \"year_domain_intervention_category_type_experiment\":TO_type_experiment;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_year -> \"year_domain_intervention_technique_binary_outcome\":TO_year;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_domain -> \"year_domain_intervention_technique_binary_outcome\":TO_domain;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_intervention_technique -> \"year_domain_intervention_technique_binary_outcome\":TO_intervention_technique;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_binary_outcome -> \"year_domain_intervention_technique_binary_outcome\":TO_binary_outcome;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_year -> \"year_domain_type_experiment_approximation\":TO_year;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_domain -> \"year_domain_type_experiment_approximation\":TO_domain;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_type_experiment -> \"year_domain_type_experiment_approximation\":TO_type_experiment;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_approximation -> \"year_domain_type_experiment_approximation\":TO_approximation;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_year -> \"year_intervention_technique_type_experiment_approximation\":TO_year;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_intervention_technique -> \"year_intervention_technique_type_experiment_approximation\":TO_intervention_technique;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_type_experiment -> \"year_intervention_technique_type_experiment_approximation\":TO_type_experiment;\n  \"year_domain_intervention_technique_type_experiment_approximation\":FROM_approximation -> \"year_intervention_technique_type_experiment_approximation\":TO_approximation;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_year -> \"year_intervention_technique_binary_outcome_approximation\":TO_year;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_intervention_technique -> \"year_intervention_technique_binary_outcome_approximation\":TO_intervention_technique;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_binary_outcome -> \"year_intervention_technique_binary_outcome_approximation\":TO_binary_outcome;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_approximation -> \"year_intervention_technique_binary_outcome_approximation\":TO_approximation;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_year -> \"year_location_domain_intervention_technique_approximation\":TO_year;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_location -> \"year_location_domain_intervention_technique_approximation\":TO_location;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_domain -> \"year_location_domain_intervention_technique_approximation\":TO_domain;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_intervention_technique -> \"year_location_domain_intervention_technique_approximation\":TO_intervention_technique;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_approximation -> \"year_location_domain_intervention_technique_approximation\":TO_approximation;\n  \"year_location_domain_intervention_technique_approximation\":FROM_year -> \"year_location_intervention_technique_population_approximation\":TO_year;\n  \"year_location_domain_intervention_technique_approximation\":FROM_location -> \"year_location_intervention_technique_population_approximation\":TO_location;\n  \"year_location_domain_intervention_technique_approximation\":FROM_intervention_technique -> \"year_location_intervention_technique_population_approximation\":TO_intervention_technique;\n  \"year_location_domain_intervention_technique_approximation\":FROM_population -> \"year_location_intervention_technique_population_approximation\":TO_population;\n  \"year_location_domain_intervention_technique_approximation\":FROM_approximation -> \"year_location_intervention_technique_population_approximation\":TO_approximation;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_year -> \"year_domain_intervention_technique_type_experiment_approximation\":TO_year;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_domain -> \"year_domain_intervention_technique_type_experiment_approximation\":TO_domain;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_intervention_technique -> \"year_domain_intervention_technique_type_experiment_approximation\":TO_intervention_technique;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_type_experiment -> \"year_domain_intervention_technique_type_experiment_approximation\":TO_type_experiment;\n  \"year_location_domain_intervention_technique_type_experiment_binary_outcome_approximation\":FROM_approximation -> \"year_domain_intervention_technique_type_experiment_approximation\":TO_approximation;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This is a little overwhelming, so we’ll use a utility function called
<code>reduce</code>. This returns only the named “main” relation, and
any relations for which it is a descendant via foreign key references.
Reducing the approximate schema, with the effect size table as the main
table, gives us this set of relations:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">nudge_approx_database_schema</span>, <span class="st">"es_id"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-0caf26d4e3c00206b0c5" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-0caf26d4e3c00206b0c5">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">publication_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_domain\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_domain<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"publication_id_domain\":FROM_publication_id -> \"publication_id\":TO_publication_id;\n  \"publication_id_type_experiment\":FROM_publication_id -> \"publication_id\":TO_publication_id;\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_publication_id -> \"publication_id_domain\":TO_publication_id;\n  \"study_id\":FROM_domain -> \"publication_id_domain\":TO_domain;\n  \"study_id\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"study_id\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Questionable intermediate relations aside, we can see that there is
now a publication-level relation with the publication ID as a key, since
it determines the publication attributes once we remove one of the
duplicate records we discovered before.</p>
<p><code>reduce</code> can also be used on databases, where it considers
each relation with the largest number of records as a main table. It
needs to be used with caution: while the relations it removes are often
spurious, it’s possible to find databases where relations not linked to
the main relation by foreign key references are required to rejoin to
the original data frame, so reduction can remove necessary relations.
Its intent is mostly to make glancing at database plots more
manageable.</p>
</div>
<div class="section level3">
<h3 id="avoidable-attributes">Avoidable attributes<a class="anchor" aria-label="anchor" href="#avoidable-attributes"></a>
</h3>
<p>The next normal form after third normal form (3NF) is Boyes-Codd
normal form (BCNF). Ensuring BCNF is enforced by the database is
trickier, as in some cases it can’t be enforced with just relations and
foreign key constraints.</p>
<p>However, the package includes an option to convert to enhanced third
normal form, also known as LTK form, which can be so enforced. This
enhancement is tangential to BCNF, and could also be used to enhance
schemas in BCNF.</p>
<p>In brief, the standard normal forms only put constraints on the
attributes present in the relations one relation at a time. The
enhancement is a constraint on the attributes present in a relation,
while considering their presence in other relations. If a attribute in a
relation can be removed, and still be determined from that relation by
joining it to others, then the attribute is “avoidable”, and can be
removed. If the attribute is in any of the relation’s keys, they’ll be
replaced by keys that use the attributes not being removed. This removes
attributes from relations without removing any information from the
database as a whole.</p>
<p>For example, we can take this simple example from Chapter 6 of The
Theory of Relational Databases, by David Maier:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">avoid_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="st">"D"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"D"</span><span class="op">)</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  attrs_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">avoid_deps</span></span>
<span><span class="co">#&gt; 5 functional dependencies</span></span>
<span><span class="co">#&gt; 5 attributes: A, B, C, D, E</span></span>
<span><span class="co">#&gt;    A -&gt; B</span></span>
<span><span class="co">#&gt;    B -&gt; A</span></span>
<span><span class="co">#&gt; A, C -&gt; D</span></span>
<span><span class="co">#&gt; A, C -&gt; E</span></span>
<span><span class="co">#&gt; B, D -&gt; C</span></span>
<span><span class="va">avoid_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">avoid_deps</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">avoid_schema</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-da0b268a2927f570ebf3" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-da0b268a2927f570ebf3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"A\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">B<\/TD><TD><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"A_C\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A_C<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">C<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">B<\/TD><TD><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">D<\/TD><TD><\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">E<\/TD><TD><\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"A_C\":FROM_a -> \"A\":TO_a;\n  \"A_C\":FROM_b -> \"A\":TO_b;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Attributes <code>A</code> and <code>B</code> are equivalent, since
relation <code>A</code> has them both as a key. In other words, relation
<code>A</code> is a simple lookup relation. Because of this, we could
remove <code>B</code> from relation <code>A_C</code>, and replace the
key <code>B, D</code> with <code>A, D</code>, which is equivalent when
accounting for relation <code>A</code>.</p>
<p>We can have this removal of avoidable attributes done automatically,
using the <code>remove_avoidable</code> flag for
<code>normalise</code>:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">avoid_schema_removed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span></span>
<span>  <span class="va">avoid_deps</span>,</span>
<span>  remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">avoid_schema_removed</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-0ed12bb554391c49c2e3" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-0ed12bb554391c49c2e3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"A\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">B<\/TD><TD><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"A_C\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">A_C<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">A<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">C<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">D<\/TD><TD><\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">E<\/TD><TD><\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"A_C\":FROM_a -> \"A\":TO_a;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This schema is now in LTK form, with no remaining avoidable
attributes. We could have also removed <code>A</code> from relation
<code>A_C</code> instead of <code>B</code>, so this process may not have
a unique result. The package’s implementation prefers to remove
attributes that appear later in the original relation.</p>
</div>
</div>
<div class="section level2">
<h2 id="planned-improvements">Planned improvements<a class="anchor" aria-label="anchor" href="#planned-improvements"></a>
</h2>
<div class="section level3">
<h3 id="views-for-connected-reference-chains">Views for connected reference chains<a class="anchor" aria-label="anchor" href="#views-for-connected-reference-chains"></a>
</h3>
<p>When <code>autodb</code>, or <code>autoref</code>, generates foreign
key references for relations decomposed from a single table, it
naturally tends to a structure where there is a single low-level data
relation on the left, and higher-level relations are “downstream” with
respect to references, with the number of records strictly decreasing as
we follow references to higher-level data relations.</p>
<p>The nice thing about this is that, while the schema is created
constructively, we can view it as a series of decompositions: start with
the original table, split it up into two or more sub-tables, and repeat.
Rejoining the database would then do this in reverse.</p>
<p>Unfortunately, not every set of functional dependencies allows this.
Consider the following:</p>
<p>Bernstein synthesis, and automatic foreign keys, give the following
schema:</p>
<p>The schema is not connected, because <code>d_e</code>’s key is not
present in any other relation. In terms of a series of decompositions,
we could think of the original table being split into
<code>{a,b,c,d,e}</code> and <code>{d,e,f}</code> first, with a
reference between them, and <code>d</code> and <code>e</code> being
split off later, destroying the reference.</p>
<p>In short, while Boyes-Codd Normal Form may be the first normal form
that can’t always be satisfied with just relations, if we also want to
keep all the relations related to each other with foreign key references
for consistency, then third normal form also can’t always be
satisfied.</p>
<p>One way to solve this, which is a planned addition, is to allow
virtual relations, also known as views. These are relations whose data
is not stored, because it’s generated from other relations that do store
their data (real relations).</p>
<p>Usually, views are used to allow easy “look-up” of commonly-queried
aggregates. Here, we could use them to maintain the connected schema
structure. Here is a mock-up of what the resulting schema might look
like:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  rankdir = \"LR\"</span></span>
<span><span class="st">  node [shape=plaintext];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_a\"&gt;a&lt;/TD&gt;&lt;TD PORT=\"FROM_a\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"b\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"d_e\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;d_e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_f\"&gt;f&lt;/TD&gt;&lt;TD PORT=\"FROM_f\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;f&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\":FROM_b -&gt; \"b\":TO_b;</span></span>
<span><span class="st">  \"a\":FROM_c -&gt; \"c\":TO_c;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">}"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-b3f7c917b6c8ff580948" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-b3f7c917b6c8ff580948">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">b<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d_e\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">d_e<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_f\">f<\/TD><TD PORT=\"FROM_f\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"view\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <TR><TD>e<\/TD><\/TR>\n    <TR><TD>f<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_b -> \"b\":TO_b;\n  \"a\":FROM_c -> \"c\":TO_c;\n\n  \"view\":TITLE -> \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view\":TITLE -> \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Note that virtual relations have different rules to real
relations:</p>
<ul>
<li>Virtual relations need not have a key. In this example,
<code>view</code> does have <code>a</code> as a key, but this key can be
inferred from the real relations it’s a merging / joining of, so does
not need to be stated explicitly.</li>
<li>Virtual relations do not contain their own data: it’s pulled in from
the relations it merges together. This allows it to contain a set of
attributes without being an instantiation of any functional dependencies
between those attributes. For example, <code>view</code> contains
<code>{a, b}</code>, but does not introduce a redundant instance of
<code>{a} -&gt; b</code> in addition to the one in relation
<code>a</code>.</li>
<li>Instead of foreign key references to keys in other relations,
virtual relations just “refer” to the real relations they are a merging
of.</li>
</ul>
<p>This addition of virtual relations allows databases to always be
connected as a tree. This is useful for visualisation, and for planning
rejoins, since those can always be done by merging tables along foreign
key references.</p>
<p>We could explicitly show <em>all</em> of the decomposition steps as
virtual relations, but it’s not clear that it’s worth the bother:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  rankdir = \"LR\"</span></span>
<span><span class="st">  node [shape=plaintext];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_a\"&gt;a&lt;/TD&gt;&lt;TD PORT=\"FROM_a\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"b\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"d_e\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;d_e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_f\"&gt;f&lt;/TD&gt;&lt;TD PORT=\"FROM_f\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;f&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view2\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view3\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\":FROM_b -&gt; \"b\":TO_b;</span></span>
<span><span class="st">  \"a\":FROM_c -&gt; \"c\":TO_c;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"view2\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view2\":TITLE -&gt; \"view3\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view2\":TITLE -&gt; \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view3\":TITLE -&gt; \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view3\":TITLE -&gt; \"b\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">}"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-d258b2ee1c304ebe1664" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-d258b2ee1c304ebe1664">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">b<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d_e\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">d_e<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_f\">f<\/TD><TD PORT=\"FROM_f\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"view\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <TR><TD>e<\/TD><\/TR>\n    <TR><TD>f<\/TD><\/TR>\n    <\/TABLE>>];\n  \"view2\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <TR><TD>e<\/TD><\/TR>\n    <\/TABLE>>];\n  \"view3\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_b -> \"b\":TO_b;\n  \"a\":FROM_c -> \"c\":TO_c;\n\n  \"view\":TITLE -> \"view2\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view\":TITLE -> \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view2\":TITLE -> \"view3\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view2\":TITLE -> \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view3\":TITLE -> \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view3\":TITLE -> \"b\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="boyes-codd-normal-form">Boyes-Codd Normal Form<a class="anchor" aria-label="anchor" href="#boyes-codd-normal-form"></a>
</h3>
<p>Another use of the virtual relations mentioned above is that they
make BCNF always achievable. For example, take the following standard
example of a set of functional dependencies that cannot be expressed in
BCNF using just relations:</p>
<p>The above schema is in third normal form. However, it is not in the
higher Boyes-Codd normal form (BCNF), because <code>c -&gt; a</code> is
present in relation <code>a_b</code>, but not in terms of a key. This
results in some redundancy, but also means that the two representations
of <code>c -&gt; a</code> can hold sets of data that aren’t mutually
coherent :</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/create.html">create</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/insert.html">insert</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, relations <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/insert.html">insert</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, b <span class="op">=</span> <span class="fl">1L</span>, c <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, relations <span class="op">=</span> <span class="st">"a_b"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span><span class="op">$</span><span class="va">a_b</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">a</th>
<th align="right">b</th>
<th align="right">c</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span><span class="op">$</span><span class="va">c</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">c</th>
<th align="right">a</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>The standard way to fix this schema to satisfy BCNF is by splitting
relation <code>a_b</code> on the violated functional dependency, namely
<code>c -&gt; a</code>:</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-b25b670b028f478bf741" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-b25b670b028f478bf741">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b_c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">b_c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"b_c\":FROM_c -> \"c\":TO_c;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The resulting schema is now in BCNF, but we have a different problem:
the dependency <code>{a, b} -&gt; c</code> has disappeared! Fixing this
can’t be done with just real relations, but we can solve it by adding a
virtual relation. Here is a mock-up of what the resulting schema might
look like:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  rankdir = \"LR\"</span></span>
<span><span class="st">  node [shape=plaintext];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_a\"&gt;a&lt;/TD&gt;&lt;TD PORT=\"FROM_a\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"b_c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;b_c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;TD BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;TD BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"b_c\":FROM_c -&gt; \"c\":TO_c;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"b_c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">}"</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-46d1193f7ba074d981c8" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-46d1193f7ba074d981c8">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b_c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">b_c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"view\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><TD BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD>b<\/TD><TD BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD>c<\/TD><TD><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"b_c\":FROM_c -> \"c\":TO_c;\n\n  \"view\":TITLE -> \"b_c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view\":TITLE -> \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Some features to note:</p>
<ul>
<li>Unlike before, the key for <code>view</code> is required, since it
can’t be inferred from the real relations. This is how we preserve
<code>{a, b} -&gt; c</code> when decomposing to BCNF.</li>
<li>
<code>view</code> references both of the real relations, to show
that it’s the result of combining both of them. This means that
<code>view</code> “references” relation <code>c</code> both directly,
and via <code>b_c</code>. For real relations, the direct reference would
be removed as being transitive, but in this case both give necessary
information. If virtual relations get implemented, virtual-to-real
“references” would be displayed differently, to make this clear.</li>
<li>
<code>view</code> contains both <code>a</code> and <code>c</code>,
as <code>a_b</code> did before. Unlike for <code>a_b</code>, this is not
an extra appearance of <code>c -&gt; a</code>, so is not a violation of
BCNF. This is because, since <code>view</code> is virtual, its
<code>a</code> and <code>c</code> values are exactly the same as those
in relation <code>c</code>, so there is no incoherency possible.</li>
</ul>
</div>
<div class="section level3">
<h3 id="proper-handling-of-nullable-data">Proper handling of nullable data<a class="anchor" aria-label="anchor" href="#proper-handling-of-nullable-data"></a>
</h3>
<p>This addresses how to decompose data with <code>NA</code> values. See
the “Handling missing values” section for details.</p>
</div>
<div class="section level3">
<h3 id="handling-of-duplicate-records">Handling of duplicate records<a class="anchor" aria-label="anchor" href="#handling-of-duplicate-records"></a>
</h3>
<p>Relational theory is based on data being given as relations, that
cannot have duplicate records. However, it’s expected that an R user
might pass in a data frame with duplicates: for example, R comes with
some datasets, such as <code>iris</code>, that have duplicates if we
don’t include the row names.</p>
<p>At the moment, these duplicates are kept when searching for
dependencies. This can affect results for approximate dependencies,
since it changes how many records must be removed for a given dependency
to be satisfied. However, the duplicates are still removed when the data
frame is decomposed into a database. At the moment, I’m not certain on
whether these duplicates are best handled by removing them before
beginning the search, or by simply returning an error if there are
duplicate records.</p>
</div>
</div>
<div class="section level2">
<h2 id="handling-missing-values">Handling missing values<a class="anchor" aria-label="anchor" href="#handling-missing-values"></a>
</h2>
<div class="section level3">
<h3 id="missing-values">Missing values<a class="anchor" aria-label="anchor" href="#missing-values"></a>
</h3>
<p>Strictly speaking, <code>autodb</code> does not search for functional
dependencies, because these can’t account for missing values. Instead,
it searches for a weaker variant, which has been called a
<em>literal</em> functional dependency (LFD) in the literature.</p>
<p>The functional dependency <code>X -&gt; Y</code> holds if, for any
two possible records whose values in <code>X</code> are <em>equal</em>,
their values in <code>Y</code> are also <em>equal</em>. This requires
attribute values to take the <em>equality</em> operator, <code>==</code>
in R. Additionally, they must take it under binary logic: whether two
values are equal can only be true or false, not missing. This disallows
the presence of missing values (<code>NA</code> and <code>NaN</code>),
since testing for equality with a missing value returns a missing
result.</p>
<p>The literal functional dependency <code>X -&gt; Y</code> holds, or
the functional dependency <code>X -&gt; Y</code> holds literally, if,
for any two possible records whose values in <code>X</code> are
<em>identical</em>, their values in <code>Y</code> are also
<em>identical</em>, where values are identical if both are non-missing
and equal, or both are missing. In other words, missing values are
treated as not equal to non-missing values, but as equal to each other.
This requires attribute classes to take the <em>identity</em> operator,
<code><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical()</a></code> with default optional parameter values in R.
Again, they must take it under binary logic, but the identity operator
cannot return non-binary results anyway: In R, for example,
<code><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical()</a></code> can only return <code>TRUE</code> or
<code>FALSE</code>, never <code>NA</code>. There is, therefore, no
constraint on missing values in attribute classes, or on attribute
classes in general.</p>
<p>LFDs are more generic than standard functional dependencies: since
practically every class takes the identity operator, they practically
make no assumptions about the attribute classes present in a data
set.</p>
<p>There are other FD variants that handle missing values, but, unlike
most of them, LFDs still satisfy Armstrong’s axioms, allowing them to be
used in normalisation in the same way as normal FDs. For example, they
still respect transitivity: if X -&gt; Y and Y -&gt; Z literally, then X
-&gt; Z literally. This allows us to construct a database schema with
Bernstein synthesis as usual, with LFDs instead of FDs, and still get
something coherent.</p>
<p>However, ignoring the special status of missing values in this way
ignores important structural information. In the relational model, and
ideally in relational databases, we want to have no missing values at
all, partly to avoid awkward questions about what trinary logic means
with respect to filtering or joining tables. For example, take the
following data frame:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_nas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  patient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">3L</span>, <span class="fl">4L</span><span class="op">)</span>,</span>
<span>  trial_entry_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2022/05/02"</span>, <span class="st">"2022/06/06"</span>, <span class="st">"2022/04/01"</span>, <span class="st">"2022/03/19"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trial_exit_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"2022/10/07"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_nas</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">patient</th>
<th align="left">trial_entry_date</th>
<th align="left">trial_exit_date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2022-05-02</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2022-06-06</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">2022-04-01</td>
<td align="left">2022-10-07</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">2022-03-19</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p><code>autodb</code> currently treats <code>NA</code> as just another
value, which results in the initial data frame not being split in the
database schema:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">df_nas</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-382a200f56fb8e6a1fd3" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-382a200f56fb8e6a1fd3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"patient\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">patient (4 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_patient\">patient<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_patient\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_trial_entry_date\">trial_entry_date<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_trial_entry_date\">Date<\/TD><\/TR>\n    <TR><TD PORT=\"TO_trial_exit_date\">trial_exit_date<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_trial_exit_date\">Date<\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>In this case, a missing exit date represents no exit date, i.e. that
the patient is still in the trail, and we would prefer to move exit
information to a separate relation, containing only patients with a exit
date:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ideal_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span></span>
<span>  <span class="va">df_nas</span>,</span>
<span>  <span class="fu"><a href="../reference/database_schema.html">database_schema</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/relation_schema.html">relation_schema</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        patient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="st">"trial_entry_date"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"patient"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        patient_exit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="st">"trial_exit_date"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"patient"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_nas</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"patient_exit"</span>, <span class="st">"patient"</span>, <span class="st">"patient"</span>, <span class="st">"patient"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">ideal_db</span><span class="op">)</span><span class="op">$</span><span class="va">patient_exit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">ideal_db</span><span class="op">)</span><span class="op">$</span><span class="va">patient_exit</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trial_exit_date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">ideal_db</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-da403bf8187c892ade73" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-da403bf8187c892ade73">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"patient\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">patient (4 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_patient\">patient<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_patient\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_trial_entry_date\">trial_entry_date<\/TD><TD><\/TD><TD PORT=\"FROM_trial_entry_date\">Date<\/TD><\/TR>\n    <\/TABLE>>];\n  \"patient_exit\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">patient_exit (1 record)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_patient\">patient<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_patient\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_trial_exit_date\">trial_exit_date<\/TD><TD><\/TD><TD PORT=\"FROM_trial_exit_date\">Date<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"patient_exit\":FROM_patient -> \"patient\":TO_patient;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This makes more of the data’s structure apparent, and enforceable, in
the database structure, since it makes it clear that the death date is
optional. However, removing missing values in this way isn’t handled by
<code>autodb</code> itself, so it has to be done by manually creating
the schema and inserting/removing records, as shown above.</p>
</div>
<div class="section level3">
<h3 id="structure-conditional-on-value-presence">Structure conditional on value presence<a class="anchor" aria-label="anchor" href="#structure-conditional-on-value-presence"></a>
</h3>
<p>Sometimes, the structure for some attributes depends on whether other
attributes are missing. Here are two possible reasons:</p>
<ul>
<li>Some piece of information in a record takes one of several possible
formats, which may have different data classes. This leaves the single
piece of information spread across multiple sets of attributes, not
necessarily disjoint, of which only one set is non-missing per record.
In more general programming, this would be referred to as a union type.
In relational theory, this is called a disjunctive existence union.</li>
<li>A set of attributes are missing or non-missing together. In more
general programming, these attributes together represent an option type,
or a nullable class.</li>
<li>Sets of attributes are mutually exclusive. In more general
programming, these attributes together represent a discriminated union,
or sum type.</li>
</ul>
<p>For example, the data below records values, and allows them to be
single values, or an interval with an associated distribution, which may
have some distribution parameters. This format is common when listing
model parameters.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.3</span>, <span class="fl">2.3</span>, <span class="fl">5.7</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span><span class="op">)</span>,</span>
<span>  lower_bound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="fl">2.4</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">5.6</span>, <span class="fl">2.4</span>, <span class="fl">5.3</span>, <span class="fl">5.3</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">5.6</span>, <span class="fl">2.4</span><span class="op">)</span>,</span>
<span>  upper_bound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="fl">7.1</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">13.1</span>, <span class="fl">25.8</span>, <span class="fl">10</span>, <span class="fl">13.1</span>, <span class="fl">10</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>,<span class="fl">13.1</span>, <span class="fl">13.1</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span><span class="op">)</span>,</span>
<span>  interval_distribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"Beta"</span>, <span class="st">"Beta"</span>, <span class="st">"Beta"</span>, <span class="st">"Beta"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"PERT"</span>, <span class="st">"PERT"</span>, <span class="st">"PERT"</span>, <span class="st">"PERT"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  param1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2.1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  param2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_options</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="8%">
<col width="17%">
<col width="17%">
<col width="31%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="right">value</th>
<th align="right">lower_bound</th>
<th align="right">upper_bound</th>
<th align="left">interval_distribution</th>
<th align="right">param1</th>
<th align="right">param2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2.3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2.3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">5.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">7.1</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">NA</td>
<td align="right">0.0</td>
<td align="right">10.0</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">NA</td>
<td align="right">1.0</td>
<td align="right">10.0</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">NA</td>
<td align="right">0.0</td>
<td align="right">13.1</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">NA</td>
<td align="right">5.6</td>
<td align="right">25.8</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">10.0</td>
<td align="left">Beta</td>
<td align="right">1.0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">NA</td>
<td align="right">5.3</td>
<td align="right">13.1</td>
<td align="left">Beta</td>
<td align="right">1.0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">NA</td>
<td align="right">5.3</td>
<td align="right">10.0</td>
<td align="left">Beta</td>
<td align="right">1.0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Beta</td>
<td align="right">2.0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">13.1</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">13.1</td>
<td align="left">PERT</td>
<td align="right">2.0</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">PERT</td>
<td align="right">1.0</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">NA</td>
<td align="right">5.6</td>
<td align="right">25.8</td>
<td align="left">PERT</td>
<td align="right">2.0</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">PERT</td>
<td align="right">2.0</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p><code>autodb</code> has no way to know about these relationships,
because it doesn’t treat missing values as a special case, as described
above. The resulting schema therefore ignores them:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">df_options</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db_options</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-756e3bf13eb93ebd21f9" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-756e3bf13eb93ebd21f9">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">id (20 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_id\">id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value\">value<\/TD><TD><\/TD><TD PORT=\"FROM_value\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound\">lower_bound<\/TD><TD><\/TD><TD PORT=\"FROM_lower_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound\">upper_bound<\/TD><TD><\/TD><TD PORT=\"FROM_upper_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1\">param1<\/TD><TD><\/TD><TD PORT=\"FROM_param1\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2\">param2<\/TD><TD><\/TD><TD PORT=\"FROM_param2\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>However, from looking at the data ourselves, we can see a
clearly-implied structure:</p>
<ul>
<li>A record either has a perfectly-known value, or a distribution of
what the value could be. These two options have separate
attributes.</li>
<li>Distribution information contains a lower and upper bound, and a
distribution type. Different distributions have different numbers of
distribution parameters, which are given in shared parameter
attributes.</li>
<li>Parameter attributes are ordered: their value can only be
non-missing if all of the previous parameter values are
non-missing.</li>
</ul>
<p>As a general hack for finding these sorts of relationships, I like
taking each attribute with missing values, and adding a companion
attribute that states whether the value is present or missing:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_options_presence</span> <span class="op">&lt;-</span> <span class="va">df_options</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">df_options</span>, <span class="va">anyNA</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df_options_presence</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df_options_presence</span>, <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_options_presence</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_options_presence</span><span class="op">)</span>, <span class="st">"_present"</span><span class="op">)</span></span>
<span><span class="va">df_options_with_presence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_options</span>, <span class="va">df_options_presence</span><span class="op">)</span></span></code></pre></div>
<p>This is not always practical, because adding columns rapidly
increases the running time for the dependency search. However, when it’s
practical, it helps to make the structure more apparent in the database
schema:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_options_with_presence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">df_options_with_presence</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db_options_with_presence</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-2931a41253ddcd61f464" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-2931a41253ddcd61f464">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">id (20 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_id\">id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value\">value<\/TD><TD><\/TD><TD PORT=\"FROM_value\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound\">lower_bound<\/TD><TD><\/TD><TD PORT=\"FROM_lower_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound\">upper_bound<\/TD><TD><\/TD><TD PORT=\"FROM_upper_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1\">param1<\/TD><TD><\/TD><TD PORT=\"FROM_param1\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2\">param2<\/TD><TD><\/TD><TD PORT=\"FROM_param2\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  \"value\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">value (3 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value\">value<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_value\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"lower_bound\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">lower_bound (6 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound\">lower_bound<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_lower_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"upper_bound\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">upper_bound (5 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound\">upper_bound<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_upper_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"interval_distribution\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">interval_distribution (5 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1_present\">param1_present<\/TD><TD><\/TD><TD PORT=\"FROM_param1_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2_present\">param2_present<\/TD><TD><\/TD><TD PORT=\"FROM_param2_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"param1\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">param1 (4 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1\">param1<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_param1\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1_present\">param1_present<\/TD><TD><\/TD><TD PORT=\"FROM_param1_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"param2\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">param2 (3 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2\">param2<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_param2\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2_present\">param2_present<\/TD><TD><\/TD><TD PORT=\"FROM_param2_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"value_present\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"6\">value_present (2 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound_present\">lower_bound_present<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_lower_bound_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound_present\">upper_bound_present<\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_upper_bound_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution_present\">interval_distribution_present<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_interval_distribution_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"id\":FROM_value -> \"value\":TO_value;\n  \"id\":FROM_lower_bound -> \"lower_bound\":TO_lower_bound;\n  \"id\":FROM_upper_bound -> \"upper_bound\":TO_upper_bound;\n  \"id\":FROM_interval_distribution -> \"interval_distribution\":TO_interval_distribution;\n  \"id\":FROM_param1 -> \"param1\":TO_param1;\n  \"id\":FROM_param2 -> \"param2\":TO_param2;\n  \"value\":FROM_value_present -> \"value_present\":TO_value_present;\n  \"lower_bound\":FROM_value_present -> \"value_present\":TO_value_present;\n  \"upper_bound\":FROM_value_present -> \"value_present\":TO_value_present;\n  \"interval_distribution\":FROM_value_present -> \"value_present\":TO_value_present;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Some of the new relations just show that an attribute determines its
associated presence attribute, which is always true. Of more interest is
the <code>value_present</code> relation, which shows that the values,
bounds, and interval distributions inform the presence of each
other:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db_options_with_presence</span><span class="op">)</span><span class="op">$</span><span class="va">value_present</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="16%">
<col width="22%">
<col width="22%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">value_present</th>
<th align="left">lower_bound_present</th>
<th align="left">upper_bound_present</th>
<th align="left">interval_distribution_present</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>In the <code>interval_distribution</code> relation, we can also see
how the interval distribution determines how many parameters are
required:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db_options_with_presence</span><span class="op">)</span><span class="op">$</span><span class="va">interval_distribution</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="31%">
<col width="20%">
<col width="21%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">interval_distribution</th>
<th align="left">value_present</th>
<th align="left">param1_present</th>
<th align="left">param2_present</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">uniform</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">Beta</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">13</td>
<td align="left">Kumaraswamy</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="left">PERT</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>This shows addition structure, specifically an existence constraint:
if <code>param2</code> is present, then <code>param1</code> is also
present. If we notice a situation like this, we can attempt further
investigation by splitting the data, and passing each part into
<code>autodb</code> separately. Splitting on whether <code>param1</code>
is present, we get the following database for records where it is
absent:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_options_with_presence_p1absent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">df_options_with_presence</span>,</span>
<span>  <span class="op">!</span><span class="va">param1_present</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db_options_with_presence_p1absent</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-853270d7a7ddd5c78dff" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-853270d7a7ddd5c78dff">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"constants\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">constants (1 record)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1\">param1<\/TD><TD><\/TD><TD PORT=\"FROM_param1\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2\">param2<\/TD><TD><\/TD><TD PORT=\"FROM_param2\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1_present\">param1_present<\/TD><TD><\/TD><TD PORT=\"FROM_param1_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2_present\">param2_present<\/TD><TD><\/TD><TD PORT=\"FROM_param2_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">id (8 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_id\">id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value\">value<\/TD><TD><\/TD><TD PORT=\"FROM_value\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound\">lower_bound<\/TD><TD><\/TD><TD PORT=\"FROM_lower_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound\">upper_bound<\/TD><TD><\/TD><TD PORT=\"FROM_upper_bound\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  \"value\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">value (3 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value\">value<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_value\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"lower_bound\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">lower_bound (5 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound\">lower_bound<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_lower_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"upper_bound\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">upper_bound (5 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound\">upper_bound<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_upper_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"interval_distribution\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"7\">interval_distribution (2 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound_present\">lower_bound_present<\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_lower_bound_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound_present\">upper_bound_present<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_upper_bound_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution_present\">interval_distribution_present<\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_interval_distribution_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"id\":FROM_value -> \"value\":TO_value;\n  \"id\":FROM_lower_bound -> \"lower_bound\":TO_lower_bound;\n  \"id\":FROM_upper_bound -> \"upper_bound\":TO_upper_bound;\n  \"value\":FROM_interval_distribution -> \"interval_distribution\":TO_interval_distribution;\n  \"lower_bound\":FROM_interval_distribution -> \"interval_distribution\":TO_interval_distribution;\n  \"upper_bound\":FROM_interval_distribution -> \"interval_distribution\":TO_interval_distribution;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This only contains records for point estimates, or intervals with a
uniform distribution, so the distribution value is now equivalent to its
presence/absence, or that of the value and bounds. Due to the existence
constraint mentioned above, <code>param2</code> is constant, since it’s
always absent:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db_options_with_presence_p1absent</span><span class="op">)</span><span class="op">$</span><span class="va">constants</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param1</th>
<th align="right">param2</th>
<th align="left">param1_present</th>
<th align="left">param2_present</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr></tbody>
</table>
<p>We get the following database for records where <code>param1</code>
is present:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">df_options_with_presence</span>,</span>
<span>  <span class="va">param1_present</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-4211ee8e5b9f7bea17a6" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-4211ee8e5b9f7bea17a6">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"constants\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">constants (1 record)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value\">value<\/TD><TD><\/TD><TD PORT=\"FROM_value\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_value_present\">value_present<\/TD><TD><\/TD><TD PORT=\"FROM_value_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound_present\">lower_bound_present<\/TD><TD><\/TD><TD PORT=\"FROM_lower_bound_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound_present\">upper_bound_present<\/TD><TD><\/TD><TD PORT=\"FROM_upper_bound_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution_present\">interval_distribution_present<\/TD><TD><\/TD><TD PORT=\"FROM_interval_distribution_present\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1_present\">param1_present<\/TD><TD><\/TD><TD PORT=\"FROM_param1_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">id (12 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_id\">id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_lower_bound\">lower_bound<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_lower_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_upper_bound\">upper_bound<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_upper_bound\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param1\">param1<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_param1\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2\">param2<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_param2\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n  \"interval_distribution\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">interval_distribution (3 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_interval_distribution\">interval_distribution<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_interval_distribution\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2_present\">param2_present<\/TD><TD><\/TD><TD PORT=\"FROM_param2_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"param2\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">param2 (3 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2\">param2<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_param2\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_param2_present\">param2_present<\/TD><TD><\/TD><TD PORT=\"FROM_param2_present\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"id\":FROM_interval_distribution -> \"interval_distribution\":TO_interval_distribution;\n  \"id\":FROM_param2 -> \"param2\":TO_param2;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>In this case, whether <code>param2</code> is present is determined by
the distribution used, as we’d expect.</p>
<p>Since this data splitting is currently a manual process, there are
practical limits to how far we can take this. In the future, I’d like to
have automating it as an option, but this could greatly increase the
required run time.</p>
</div>
</div>
<div class="section level2">
<h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<p>Automatic data normalisation, such as done by <code>autodb</code>, is
useful, but it isn’t magic. This vignette covers some common issues that
this approach can’t address.</p>
<div class="section level3">
<h3 id="value-based-constraints">Value-based constraints<a class="anchor" aria-label="anchor" href="#value-based-constraints"></a>
</h3>
<p>Since the process is agnostic to what kind of data is stored in each
attribute, it can’t find any constraints that depend on the actual data
values. A simple case is that, for example, it won’t state whether an
attribute’s values are within a given range, since that would require
making use of the knowledge that the attribute has a number class, such
as <code>integer</code> or <code>numeric</code>.</p>
</div>
<div class="section level3">
<h3 id="semantic-types">Semantic types<a class="anchor" aria-label="anchor" href="#semantic-types"></a>
</h3>
<p>Another example of the process being agnostic to data values is that
it can’t make any inference based on attribute classes. A common example
of this is when we have entities of a given type referring to each
other.</p>
<p>For example, suppose we have a dataset of publication citations,
where each row contains the citer and citee IDs, plus supplementary
information about both publications. The resulting database given by
<code>autodb</code> has the following schema, after giving the relations
appropriate names:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/database_schema.html">database_schema</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/relation_schema.html">relation_schema</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      citation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer_id"</span>, <span class="st">"citee_id"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer_id"</span>, <span class="st">"citee_id"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      citer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer_id"</span>, <span class="st">"citer_title"</span>, <span class="st">"citer_author"</span>, <span class="st">"citer_year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citer_id"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      citee <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citee_id"</span>, <span class="st">"citee_title"</span>, <span class="st">"citee_author"</span>, <span class="st">"citee_year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citee_id"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"citer_id"</span>, <span class="st">"citer_title"</span>, <span class="st">"citer_author"</span>, <span class="st">"citer_year"</span>,</span>
<span>      <span class="st">"citee_id"</span>, <span class="st">"citee_title"</span>, <span class="st">"citee_author"</span>, <span class="st">"citee_year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citer_id"</span>, <span class="st">"citer"</span>, <span class="st">"citer_id"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citee_id"</span>, <span class="st">"citee"</span>, <span class="st">"citee_id"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-59344719eea48f3263a0" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-59344719eea48f3263a0">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"citation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_id\">citer_id<\/TD><TD PORT=\"FROM_citer_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_id\">citee_id<\/TD><TD PORT=\"FROM_citee_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"citer\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_id\">citer_id<\/TD><TD PORT=\"FROM_citer_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_title\">citer_title<\/TD><TD PORT=\"FROM_citer_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_author\">citer_author<\/TD><TD PORT=\"FROM_citer_author\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_year\">citer_year<\/TD><TD PORT=\"FROM_citer_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"citee\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citee<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_id\">citee_id<\/TD><TD PORT=\"FROM_citee_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_title\">citee_title<\/TD><TD PORT=\"FROM_citee_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_author\">citee_author<\/TD><TD PORT=\"FROM_citee_author\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_year\">citee_year<\/TD><TD PORT=\"FROM_citee_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"citation\":FROM_citer_id -> \"citer\":TO_citer_id;\n  \"citation\":FROM_citee_id -> \"citee\":TO_citee_id;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Of course, citers and citees are both publications of the same type,
so they shouldn’t have separate relations:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/database_schema.html">database_schema</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/relation_schema.html">relation_schema</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      citation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer"</span>, <span class="st">"citee"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer"</span>, <span class="st">"citee"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      publication <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"title"</span>, <span class="st">"author"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer"</span>, <span class="st">"citee"</span>, <span class="st">"id"</span>, <span class="st">"title"</span>, <span class="st">"author"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citer"</span>, <span class="st">"publication"</span>, <span class="st">"id"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citee"</span>, <span class="st">"publication"</span>, <span class="st">"id"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-1c18eca156cc321e99f7" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1c18eca156cc321e99f7">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"citation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer\">citer<\/TD><TD PORT=\"FROM_citer\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee\">citee<\/TD><TD PORT=\"FROM_citee\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication<\/TD><\/TR>\n    <TR><TD PORT=\"TO_id\">id<\/TD><TD PORT=\"FROM_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_author\">author<\/TD><TD PORT=\"FROM_author\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"citation\":FROM_citer -> \"publication\":TO_id;\n  \"citation\":FROM_citee -> \"publication\":TO_id;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We make this improvement because <code>citer_id</code> and
<code>citee_id</code> values are, semantically, the same class of
object, and the same goes for authors, titles, etc. Semantic types are
not something that can be inferred by just looking at the data
classes.</p>
<p>If we don’t account for this semantic identity, the separate citer
and citee information relations in the original schema can both hold
information for the same publication. If their information is the same,
then there is unwanted redundancy. If their information is different,
there is a data incoherency not prevented by the schema. Neither
situation is desirable.</p>
<p>Currently, the only way to account for this semantic identity to
create or modify the schema manually, like above.</p>
</div>
</div>
<div class="section level2">
<h2 id="table-merges-dont-fix-issues-with-merge-data-frame">Table merges don’t fix issues with
<code>merge.data.frame</code><a class="anchor" aria-label="anchor" href="#table-merges-dont-fix-issues-with-merge-data-frame"></a>
</h2>
<p>Rejoining databases, and checking relations satisfy foreign key
constraints, is done using <code>merge.data.frame</code>. This means
that data classes that don’t work properly in <code>merge</code> aren’t
guaranteed to work properly in <code>autodb</code>.</p>
<p>Any such issues come from how certain data classes are handled during
merges in the base language, so they are issues with R, rather than with
<code>autodb</code>, and I have no plans to fix them. If
<code>autodb</code> seems to have odd failures, check that used data
classes behave correctly in merges.</p>
<p>For example, in older versions of R, the built-in POSIXct date/time
class didn’t have values merged properly, because the merge didn’t
account for differences in time zone / daylight saving time. This would
result in, for example, the <code>nycflights13::weather</code> data set
violating the foreign key constraints of its own discovered schema,
since one foreign key used a POSIXct attribute.</p>
<p>A more complex example, that still applies and probably always will,
is a merge where two attributes being merged on have different classes.
In general, this is allowed: since <code>autodb</code> is written for R,
a dynamically-typed language, it follows SQLite in not constraining the
user much when it comes to data classes in schemas. For primitive
classes, R’s class coercion usually makes things work as you’d
expect.</p>
<p>However, merging a factor attribute with a non-factor, non-character
attribute should be handled with caution if the latter contains values
not in the factor’s level set.</p>
<p>For example, we can define these data frames:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_badmerge_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0L</span>, <span class="fl">1L</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  row <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df_badmerge_factor</span> <span class="op">&lt;-</span> <span class="va">df_badmerge_int</span></span>
<span><span class="va">df_badmerge_factor</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_badmerge_factor</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_badmerge_int</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">a</th>
<th align="left">b</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_badmerge_logical</span> <span class="op">&lt;-</span> <span class="va">df_badmerge_int</span></span>
<span><span class="va">df_badmerge_logical</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">df_badmerge_logical</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_badmerge_logical</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"row2"</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_badmerge_logical</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="left">b</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">NA</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>We can then merge the data frame with logical <code>a</code> with the
other two, keeping the <code>row</code> attributes to track which
records were merged.</p>
<p>Whichever other data frame we merge with, the two sets of
<code>a</code> values have different classes, so R does coercion. When
merging with just <code>a</code>, this gives the result we’d expect, for
both other data frames and regardless of merge order. For the integer
version, the logical values are coerced to integers:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_int</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">a</th>
<th align="right">row</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_int</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="right">row2</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>For the factor version, the logical values are coerced to factors,
but they don’t match any of the given levels, so they all become
<code>NA</code>:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_factor</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="right">row</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_factor</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="right">row2</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>However, we see unexpected behaviour with the factor version, when
also merging on another attribute, <code>b</code>: the merge result now
depends on the input order. With the factor version first, the result is
similar to before:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_factor</span>,</span>
<span>  <span class="va">df_badmerge_logical</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in `[&lt;-.factor`(`*tmp*`, ri, value = c(NA, FALSE, TRUE, NA, FALSE, :</span></span>
<span><span class="co">#&gt; invalid factor level, NA generated</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="left">b</th>
<th align="right">row</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>With the logical version first, however, only the logical
<code>a</code> values that are <code>NA</code> before coercion are kept,
rather than all of them:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_logical</span>,</span>
<span>  <span class="va">df_badmerge_factor</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="left">b</th>
<th align="right">row2</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<p>In <code>autodb</code>, this could be a problem if two relations in a
foreign key constraint contain the same attribute, but one of them has
it store factors in records, due to separate insertions. Letting an
attribute’s class vary across relations should, therefore, be done with
caution.</p>
<div class="section level3">
<h3 id="synthesis-doesnt-minimise-relation-key-count">Synthesis doesn’t minimise relation key count<a class="anchor" aria-label="anchor" href="#synthesis-doesnt-minimise-relation-key-count"></a>
</h3>
<p>Bernstein’s synthesis is guaranteed to minimise the number of
relations created for a given set of functional dependencies, and
removing avoidable attributes can reduce the number of attributes in
those relations. However, there can still be redundant keys. For
example, we can take the following set of functional dependencies:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fds_redkey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"d"</span><span class="op">)</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fds_redkey</span></span>
<span><span class="co">#&gt; 5 functional dependencies</span></span>
<span><span class="co">#&gt; 4 attributes: a, b, c, d</span></span>
<span><span class="co">#&gt;    a -&gt; b</span></span>
<span><span class="co">#&gt;    d -&gt; c</span></span>
<span><span class="co">#&gt; b, d -&gt; a</span></span>
<span><span class="co">#&gt;    a -&gt; c</span></span>
<span><span class="co">#&gt; b, c -&gt; d</span></span></code></pre></div>
<p>Normalising gives the following relations:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema_redkey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">fds_redkey</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">schema_redkey</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-82903e20e82fe9e96ad4" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-82903e20e82fe9e96ad4">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">d<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_d -> \"d\":TO_d;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>These relations have some redundancy: relation <code>a</code> implies
<code>{b, d} -&gt; c</code>, but relation <code>d</code> implies that
<code>{d} -&gt; c</code>. This isn’t resolved by removing avoidable
attributes, because <code>d</code> still needs to be in relation
<code>a</code>: we just need to remove <code>{b, d}</code> as a key.
However, this is resolved if we instead use this set of functional
dependencies, which is equivalent to the previous set:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fds_redkey_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fds_redkey_fix</span></span>
<span><span class="co">#&gt; 4 functional dependencies</span></span>
<span><span class="co">#&gt; 4 attributes: a, b, c, d</span></span>
<span><span class="co">#&gt;    a -&gt; b</span></span>
<span><span class="co">#&gt;    d -&gt; c</span></span>
<span><span class="co">#&gt; b, c -&gt; a</span></span>
<span><span class="co">#&gt;    a -&gt; d</span></span>
<span><span class="va">schema_redkey_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">fds_redkey_fix</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">schema_redkey_fix</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-91e95a97e1d3447d8bab" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-91e95a97e1d3447d8bab">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD><\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD><\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">d<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_d -> \"d\":TO_d;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Unfortunately, there’s no way in the package to find better sets like
this.</p>
</div>
<div class="section level3">
<h3 id="normal-forms-aret-all-there-is-to-database-design">Normal forms are’t all there is to database design<a class="anchor" aria-label="anchor" href="#normal-forms-aret-all-there-is-to-database-design"></a>
</h3>
<p>Normal forms only refer to one relation at a time: referring to a
database as being in a given normal form just means that each if its
relations are in it individually. This doesn’t address the addition of
foreign key references, but, even if the references are sensible,
schemas that are in higher normal forms may not be ones that we’d want
to use.</p>
<p>For example, take this database schema, whose relation schemas are in
third normal form:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dup_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">dup_db</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-16ec33930352bd7ed495" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-16ec33930352bd7ed495">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Chick (50 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD><\/TD><TD PORT=\"FROM_diet\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"Time_Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Time_Chick (578 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_time\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD><\/TD><TD PORT=\"FROM_weight\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"Time_Chick\":FROM_chick -> \"Chick\":TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>If we now create copies of these relations, with the intention that
copies always contain the same data, then all relations are still in
third normal form, and so we’d say this database is also in third normal
form:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">dup_db</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>However, no one would claim that this is a good database design,
since there is clearly a large amount of data redundancy. Higher normal
forms would not change this. In fact, since the copies do not reference
each other, it is also trivial to insert data to make this database
incoherent. For example, <code>Chick</code> and <code>Chick.1</code>
could contain different diet assignments.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Webster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
