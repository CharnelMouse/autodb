<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Planned improvements • autodb</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Planned improvements">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">autodb</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/autodb.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/limits.html">Limitations</a></li>
    <li><a class="dropdown-item" href="../articles/nudge.html">A larger example: the nudge dataset</a></li>
    <li><a class="dropdown-item" href="../articles/null.html">Handling missing values</a></li>
    <li><a class="dropdown-item" href="../articles/plans.html">Planned improvements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CharnelMouse/autodb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="plans_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="plans_files/viz-1.8.2/viz.js"></script><link href="plans_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="plans_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Planned improvements</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CharnelMouse/autodb/blob/master/vignettes/plans.Rmd" class="external-link"><code>vignettes/plans.Rmd</code></a></small>
      <div class="d-none name"><code>plans.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://charnelmouse.github.io/autodb/">autodb</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'autodb'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     decompose</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="va">print</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="views-for-connected-reference-chains">Views for connected reference chains<a class="anchor" aria-label="anchor" href="#views-for-connected-reference-chains"></a>
</h2>
<p>When <code>autodb</code>, or <code>autoref</code>, generates foreign
key references for relations decomposed from a single table, it
naturally tends to a structure where there is a single low-level data
relation on the left, and higher-level relations are “downstream” with
respect to references, with the number of records strictly decreasing as
we follow references to higher-level data relations.</p>
<p>The nice thing about this is that, while the schema is created
constructively, we can view it as a series of decompositions: start with
the original table, split it up into two or more sub-tables, and repeat.
Rejoining the database would then do this in reverse.</p>
<p>Unfortunately, not every set of functional dependencies allows this.
Consider the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"d"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="st">"e"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"e"</span><span class="op">)</span>, <span class="st">"f"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fds</span></span></code></pre></div>
<pre><code><span><span class="co">## 5 functional dependencies</span></span>
<span><span class="co">## 6 attributes: a, b, c, d, e, f</span></span>
<span><span class="co">##    a -&gt; b</span></span>
<span><span class="co">##    a -&gt; c</span></span>
<span><span class="co">##    b -&gt; d</span></span>
<span><span class="co">##    c -&gt; e</span></span>
<span><span class="co">## d, e -&gt; f</span></span></code></pre>
<p>Bernstein synthesis, and automatic foreign keys, give the following
schema:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">fds</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">schema</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">b<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d_e\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">d_e<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_f\">f<\/TD><TD PORT=\"FROM_f\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_b -> \"b\":TO_b;\n  \"a\":FROM_c -> \"c\":TO_c;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The schema is not connected, because <code>d_e</code>’s key is not
present in any other relation. In terms of a series of decompositions,
we could think of the original table being split into
<code>{a,b,c,d,e}</code> and <code>{d,e,f}</code> first, with a
reference between them, and <code>d</code> and <code>e</code> being
split off later, destroying the reference.</p>
<p>In short, while Boyes-Codd Normal Form may be the first normal form
that can’t always be satisfied with just relations, if we also want to
keep all the relations related to each other with foreign key references
for consistency, then third normal form also can’t always be
satisfied.</p>
<p>One way to solve this, which is a planned addition, is to allow
virtual relations, also known as views. These are relations whose data
is not stored, because it’s generated from other relations that do store
their data (real relations).</p>
<p>Usually, views are used to allow easy “look-up” of commonly-queried
aggregates. Here, we could use them to maintain the connected schema
structure. Here is a mock-up of what the resulting schema might look
like:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  rankdir = \"LR\"</span></span>
<span><span class="st">  node [shape=plaintext];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_a\"&gt;a&lt;/TD&gt;&lt;TD PORT=\"FROM_a\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"b\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"d_e\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;d_e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_f\"&gt;f&lt;/TD&gt;&lt;TD PORT=\"FROM_f\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;f&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\":FROM_b -&gt; \"b\":TO_b;</span></span>
<span><span class="st">  \"a\":FROM_c -&gt; \"c\":TO_c;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">}"</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">b<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d_e\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">d_e<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_f\">f<\/TD><TD PORT=\"FROM_f\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"view\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <TR><TD>e<\/TD><\/TR>\n    <TR><TD>f<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_b -> \"b\":TO_b;\n  \"a\":FROM_c -> \"c\":TO_c;\n\n  \"view\":TITLE -> \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view\":TITLE -> \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Note that virtual relations have different rules to real
relations:</p>
<ul>
<li>Virtual relations need not have a key. In this example,
<code>view</code> does have <code>a</code> as a key, but this key can be
inferred from the real relations it’s a merging / joining of, so does
not need to be stated explicitly.</li>
<li>Virtual relations do not contain their own data: it’s pulled in from
the relations it merges together. This allows it to contain a set of
attributes without being an instantiation of any functional dependencies
between those attributes. For example, <code>view</code> contains
<code>{a, b}</code>, but does not introduce a redundant instance of
<code>{a} -&gt; b</code> in addition to the one in relation
<code>a</code>.</li>
<li>Instead of foreign key references to keys in other relations,
virtual relations just “refer” to the real relations they are a merging
of.</li>
</ul>
<p>This addition of virtual relations allows databases to always be
connected as a tree. This is useful for visualisation, and for planning
rejoins, since those can always be done by merging tables along foreign
key references.</p>
<p>We could explicitly show <em>all</em> of the decomposition steps as
virtual relations, but it’s not clear that it’s worth the bother:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  rankdir = \"LR\"</span></span>
<span><span class="st">  node [shape=plaintext];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_a\"&gt;a&lt;/TD&gt;&lt;TD PORT=\"FROM_a\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"b\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"d_e\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;d_e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_d\"&gt;d&lt;/TD&gt;&lt;TD PORT=\"FROM_d\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_e\"&gt;e&lt;/TD&gt;&lt;TD PORT=\"FROM_e\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_f\"&gt;f&lt;/TD&gt;&lt;TD PORT=\"FROM_f\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;f&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view2\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;e&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view3\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"1\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;d&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"a\":FROM_b -&gt; \"b\":TO_b;</span></span>
<span><span class="st">  \"a\":FROM_c -&gt; \"c\":TO_c;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"view2\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view2\":TITLE -&gt; \"view3\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view2\":TITLE -&gt; \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view3\":TITLE -&gt; \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view3\":TITLE -&gt; \"b\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">}"</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">b<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d_e\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">d_e<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_e\">e<\/TD><TD PORT=\"FROM_e\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_f\">f<\/TD><TD PORT=\"FROM_f\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"view\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <TR><TD>e<\/TD><\/TR>\n    <TR><TD>f<\/TD><\/TR>\n    <\/TABLE>>];\n  \"view2\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <TR><TD>e<\/TD><\/TR>\n    <\/TABLE>>];\n  \"view3\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"1\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><\/TR>\n    <TR><TD>b<\/TD><\/TR>\n    <TR><TD>c<\/TD><\/TR>\n    <TR><TD>d<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_b -> \"b\":TO_b;\n  \"a\":FROM_c -> \"c\":TO_c;\n\n  \"view\":TITLE -> \"view2\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view\":TITLE -> \"d_e\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view2\":TITLE -> \"view3\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view2\":TITLE -> \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view3\":TITLE -> \"a\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view3\":TITLE -> \"b\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="boyes-codd-normal-form">Boyes-Codd Normal Form<a class="anchor" aria-label="anchor" href="#boyes-codd-normal-form"></a>
</h2>
<p>Another use of the virtual relations mentioned above is that they
make BCNF always achievable. For example, take the following standard
example of a set of functional dependencies that cannot be expressed in
BCNF using just relations:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="st">"a"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fds</span></span></code></pre></div>
<pre><code><span><span class="co">## 2 functional dependencies</span></span>
<span><span class="co">## 3 attributes: a, b, c</span></span>
<span><span class="co">## a, b -&gt; c</span></span>
<span><span class="co">##    c -&gt; a</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">fds</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">schema</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"a_b\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">a_b<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a_b\":FROM_c -> \"c\":TO_c;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The above schema is in third normal form. However, it is not in the
higher Boyes-Codd normal form (BCNF), because <code>c -&gt; a</code> is
present in relation <code>a_b</code>, but not in terms of a key. This
results in some redundancy, but also means that the two representations
of <code>c -&gt; a</code> can hold sets of data that aren’t mutually
coherent :</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/create.html">create</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/insert.html">insert</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, relations <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/insert.html">insert</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, b <span class="op">=</span> <span class="fl">1L</span>, c <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, relations <span class="op">=</span> <span class="st">"a_b"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span><span class="op">$</span><span class="va">a_b</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">a</th>
<th align="right">b</th>
<th align="right">c</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span><span class="op">$</span><span class="va">c</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">c</th>
<th align="right">a</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>The standard way to fix this schema to satisfy BCNF is by splitting
relation <code>a_b</code> on the violated functional dependency, namely
<code>c -&gt; a</code>:</p>
<div id="htmlwidget-1fb4450895fe099f74a1" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b_c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">b_c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"b_c\":FROM_c -> \"c\":TO_c;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The resulting schema is now in BCNF, but we have a different problem:
the dependency <code>{a, b} -&gt; c</code> has disappeared! Fixing this
can’t be done with just real relations, but we can solve it by adding a
virtual relation. Here is a mock-up of what the resulting schema might
look like:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  rankdir = \"LR\"</span></span>
<span><span class="st">  node [shape=plaintext];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_a\"&gt;a&lt;/TD&gt;&lt;TD PORT=\"FROM_a\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"b_c\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;b_c&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_b\"&gt;b&lt;/TD&gt;&lt;TD PORT=\"FROM_b\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TO_c\"&gt;c&lt;/TD&gt;&lt;TD PORT=\"FROM_c\" BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st">  \"view\" [label = &lt;</span></span>
<span><span class="st">    &lt;TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\"&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD PORT=\"TITLE\" COLSPAN=\"2\"&gt;view&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;a&lt;/TD&gt;&lt;TD BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;b&lt;/TD&gt;&lt;TD BGCOLOR=\"black\"&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;TR&gt;&lt;TD&gt;c&lt;/TD&gt;&lt;TD&gt;&lt;/TD&gt;&lt;/TR&gt;</span></span>
<span><span class="st">    &lt;/TABLE&gt;&gt;];</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"b_c\":FROM_c -&gt; \"c\":TO_c;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"b_c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">  \"view\":TITLE -&gt; \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];</span></span>
<span><span class="st">}"</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-10b3b7155e8045a1b2ad" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"b_c\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">b_c<\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"view\" [label = <\n    <TABLE BGCOLOR=\"lightgrey\" BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD PORT=\"TITLE\" COLSPAN=\"2\">view<\/TD><\/TR>\n    <TR><TD>a<\/TD><TD BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD>b<\/TD><TD BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD>c<\/TD><TD><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"b_c\":FROM_c -> \"c\":TO_c;\n\n  \"view\":TITLE -> \"b_c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n  \"view\":TITLE -> \"c\":TITLE [arrowhead=\"empty\" style=\"dashed\"];\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Some features to note:</p>
<ul>
<li>Unlike before, the key for <code>view</code> is required, since it
can’t be inferred from the real relations. This is how we preserve
<code>{a, b} -&gt; c</code> when decomposing to BCNF.</li>
<li>
<code>view</code> references both of the real relations, to show
that it’s the result of combining both of them. This means that
<code>view</code> “references” relation <code>c</code> both directly,
and via <code>b_c</code>. For real relations, the direct reference would
be removed as being transitive, but in this case both give necessary
information. If virtual relations get implemented, virtual-to-real
“references” would be displayed differently, to make this clear.</li>
<li>
<code>view</code> contains both <code>a</code> and <code>c</code>,
as <code>a_b</code> did before. Unlike for <code>a_b</code>, this is not
an extra appearance of <code>c -&gt; a</code>, so is not a violation of
BCNF. This is because, since <code>view</code> is virtual, its
<code>a</code> and <code>c</code> values are exactly the same as those
in relation <code>c</code>, so there is no incoherency possible.</li>
</ul>
</div>
<div class="section level2">
<h2 id="proper-handling-of-nullable-data">Proper handling of nullable data<a class="anchor" aria-label="anchor" href="#proper-handling-of-nullable-data"></a>
</h2>
<p>This addresses how to decompose data with <code>NA</code> values. See
the “Handling missing values” section for details.</p>
</div>
<div class="section level2">
<h2 id="handling-of-duplicate-records">Handling of duplicate records<a class="anchor" aria-label="anchor" href="#handling-of-duplicate-records"></a>
</h2>
<p>Relational theory is based on data being given as relations, that
cannot have duplicate records. However, it’s expected that an R user
might pass in a data frame with duplicates: for example, R comes with
some datasets, such as <code>iris</code>, that have duplicates if we
don’t include the row names.</p>
<p>At the moment, these duplicates are kept when searching for
dependencies. This can affect results for approximate dependencies,
since it changes how many records must be removed for a given dependency
to be satisfied. However, the duplicates are still removed when the data
frame is decomposed into a database. At the moment, I’m not certain on
whether these duplicates are best handled by removing them before
beginning the search, or by simply returning an error if there are
duplicate records.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Webster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
