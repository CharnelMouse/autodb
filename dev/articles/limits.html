<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Limitations • autodb</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Limitations">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">autodb</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/autodb.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/limits.html">Limitations</a></li>
    <li><a class="dropdown-item" href="../articles/nudge.html">A larger example: the nudge dataset</a></li>
    <li><a class="dropdown-item" href="../articles/null.html">Handling missing values</a></li>
    <li><a class="dropdown-item" href="../articles/plans.html">Planned improvements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CharnelMouse/autodb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="limits_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="limits_files/viz-1.8.2/viz.js"></script><link href="limits_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="limits_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Limitations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CharnelMouse/autodb/blob/master/vignettes/limits.Rmd" class="external-link"><code>vignettes/limits.Rmd</code></a></small>
      <div class="d-none name"><code>limits.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://charnelmouse.github.io/autodb/">autodb</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'autodb'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     decompose</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="va">print</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Automatic data normalisation, such as done by <code>autodb</code>, is
useful, but it isn’t magic. This vignette covers some common issues that
this approach can’t address.</p>
<div class="section level2">
<h2 id="value-based-constraints">Value-based constraints<a class="anchor" aria-label="anchor" href="#value-based-constraints"></a>
</h2>
<p>Since the process is agnostic to what kind of data is stored in each
attribute, it can’t find any constraints that depend on the actual data
values. A simple case is that, for example, it won’t state whether an
attribute’s values are within a given range, since that would require
making use of the knowledge that the attribute has a number class, such
as <code>integer</code> or <code>numeric</code>.</p>
</div>
<div class="section level2">
<h2 id="semantic-types">Semantic types<a class="anchor" aria-label="anchor" href="#semantic-types"></a>
</h2>
<p>Another example of the process being agnostic to data values is that
it can’t make any inference based on attribute classes. A common example
of this is when we have entities of a given type referring to each
other.</p>
<p>For example, suppose we have a dataset of publication citations,
where each row contains the citer and citee IDs, plus supplementary
information about both publications. The resulting database given by
<code>autodb</code> has the following schema, after giving the relations
appropriate names:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/database_schema.html">database_schema</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/relation_schema.html">relation_schema</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      citation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer_id"</span>, <span class="st">"citee_id"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer_id"</span>, <span class="st">"citee_id"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      citer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer_id"</span>, <span class="st">"citer_title"</span>, <span class="st">"citer_author"</span>, <span class="st">"citer_year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citer_id"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      citee <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citee_id"</span>, <span class="st">"citee_title"</span>, <span class="st">"citee_author"</span>, <span class="st">"citee_year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citee_id"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"citer_id"</span>, <span class="st">"citer_title"</span>, <span class="st">"citer_author"</span>, <span class="st">"citer_year"</span>,</span>
<span>      <span class="st">"citee_id"</span>, <span class="st">"citee_title"</span>, <span class="st">"citee_author"</span>, <span class="st">"citee_year"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citer_id"</span>, <span class="st">"citer"</span>, <span class="st">"citer_id"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citee_id"</span>, <span class="st">"citee"</span>, <span class="st">"citee_id"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"citation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_id\">citer_id<\/TD><TD PORT=\"FROM_citer_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_id\">citee_id<\/TD><TD PORT=\"FROM_citee_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"citer\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_id\">citer_id<\/TD><TD PORT=\"FROM_citer_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_title\">citer_title<\/TD><TD PORT=\"FROM_citer_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_author\">citer_author<\/TD><TD PORT=\"FROM_citer_author\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer_year\">citer_year<\/TD><TD PORT=\"FROM_citer_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"citee\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citee<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_id\">citee_id<\/TD><TD PORT=\"FROM_citee_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_title\">citee_title<\/TD><TD PORT=\"FROM_citee_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_author\">citee_author<\/TD><TD PORT=\"FROM_citee_author\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee_year\">citee_year<\/TD><TD PORT=\"FROM_citee_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"citation\":FROM_citer_id -> \"citer\":TO_citer_id;\n  \"citation\":FROM_citee_id -> \"citee\":TO_citee_id;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Of course, citers and citees are both publications of the same type,
so they shouldn’t have separate relations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/database_schema.html">database_schema</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/relation_schema.html">relation_schema</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      citation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer"</span>, <span class="st">"citee"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer"</span>, <span class="st">"citee"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      publication <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"title"</span>, <span class="st">"author"</span>, <span class="st">"year"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"citer"</span>, <span class="st">"citee"</span>, <span class="st">"id"</span>, <span class="st">"title"</span>, <span class="st">"author"</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citer"</span>, <span class="st">"publication"</span>, <span class="st">"id"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"citation"</span>, <span class="st">"citee"</span>, <span class="st">"publication"</span>, <span class="st">"id"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"citation\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">citation<\/TD><\/TR>\n    <TR><TD PORT=\"TO_citer\">citer<\/TD><TD PORT=\"FROM_citer\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_citee\">citee<\/TD><TD PORT=\"FROM_citee\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication<\/TD><\/TR>\n    <TR><TD PORT=\"TO_id\">id<\/TD><TD PORT=\"FROM_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_author\">author<\/TD><TD PORT=\"FROM_author\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"citation\":FROM_citer -> \"publication\":TO_id;\n  \"citation\":FROM_citee -> \"publication\":TO_id;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We make this improvement because <code>citer_id</code> and
<code>citee_id</code> values are, semantically, the same class of
object, and the same goes for authors, titles, etc. Semantic types are
not something that can be inferred by just looking at the data
classes.</p>
<p>If we don’t account for this semantic identity, the separate citer
and citee information relations in the original schema can both hold
information for the same publication. If their information is the same,
then there is unwanted redundancy. If their information is different,
there is a data incoherency not prevented by the schema. Neither
situation is desirable.</p>
<p>Currently, the only way to account for this semantic identity to
create or modify the schema manually, like above.</p>
</div>
<div class="section level2">
<h2 id="table-merges-dont-fix-issues-with-merge-data-frame">Table merges don’t fix issues with
<code>merge.data.frame</code><a class="anchor" aria-label="anchor" href="#table-merges-dont-fix-issues-with-merge-data-frame"></a>
</h2>
<p>Rejoining databases, and checking relations satisfy foreign key
constraints, is done using <code>merge.data.frame</code>. This means
that data classes that don’t work properly in <code>merge</code> aren’t
guaranteed to work properly in <code>autodb</code>.</p>
<p>Any such issues come from how certain data classes are handled during
merges in the base language, so they are issues with R, rather than with
<code>autodb</code>, and I have no plans to fix them. If
<code>autodb</code> seems to have odd failures, check that used data
classes behave correctly in merges.</p>
<p>For example, in older versions of R, the built-in POSIXct date/time
class didn’t have values merged properly, because the merge didn’t
account for differences in time zone / daylight saving time. This would
result in, for example, the <code>nycflights13::weather</code> data set
violating the foreign key constraints of its own discovered schema,
since one foreign key used a POSIXct attribute.</p>
<p>A more complex example, that still applies and probably always will,
is a merge where two attributes being merged on have different classes.
In general, this is allowed: since <code>autodb</code> is written for R,
a dynamically-typed language, it follows SQLite in not constraining the
user much when it comes to data classes in schemas. For primitive
classes, R’s class coercion usually makes things work as you’d
expect.</p>
<p>However, merging a factor attribute with a non-factor, non-character
attribute should be handled with caution if the latter contains values
not in the factor’s level set.</p>
<p>For example, we can define these data frames:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_badmerge_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0L</span>, <span class="fl">1L</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  row <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df_badmerge_factor</span> <span class="op">&lt;-</span> <span class="va">df_badmerge_int</span></span>
<span><span class="va">df_badmerge_factor</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_badmerge_factor</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_badmerge_int</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">a</th>
<th align="left">b</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_badmerge_logical</span> <span class="op">&lt;-</span> <span class="va">df_badmerge_int</span></span>
<span><span class="va">df_badmerge_logical</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">df_badmerge_logical</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_badmerge_logical</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"row2"</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_badmerge_logical</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="left">b</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">NA</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">NA</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>We can then merge the data frame with logical <code>a</code> with the
other two, keeping the <code>row</code> attributes to track which
records were merged.</p>
<p>Whichever other data frame we merge with, the two sets of
<code>a</code> values have different classes, so R does coercion. When
merging with just <code>a</code>, this gives the result we’d expect, for
both other data frames and regardless of merge order. For the integer
version, the logical values are coerced to integers:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_int</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">a</th>
<th align="right">row</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">8</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_int</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="right">row2</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="right">9</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<p>For the factor version, the logical values are coerced to factors,
but they don’t match any of the given levels, so they all become
<code>NA</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_factor</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="right">row</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_logical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row2"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">df_badmerge_factor</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"row"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="right">row2</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>However, we see unexpected behaviour with the factor version, when
also merging on another attribute, <code>b</code>: the merge result now
depends on the input order. With the factor version first, the result is
similar to before:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_factor</span>,</span>
<span>  <span class="va">df_badmerge_logical</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in `[&lt;-.factor`(`*tmp*`, ri, value = c(NA, FALSE, TRUE, NA, FALSE, :</span></span>
<span><span class="co">## invalid factor level, NA generated</span></span></code></pre>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="left">b</th>
<th align="right">row</th>
<th align="right">row2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<p>With the logical version first, however, only the logical
<code>a</code> values that are <code>NA</code> before coercion are kept,
rather than all of them:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>  <span class="va">df_badmerge_logical</span>,</span>
<span>  <span class="va">df_badmerge_factor</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">a</th>
<th align="left">b</th>
<th align="right">row2</th>
<th align="right">row</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<p>In <code>autodb</code>, this could be a problem if two relations in a
foreign key constraint contain the same attribute, but one of them has
it store factors in records, due to separate insertions. Letting an
attribute’s class vary across relations should, therefore, be done with
caution.</p>
</div>
<div class="section level2">
<h2 id="synthesis-doesnt-minimise-relation-key-count">Synthesis doesn’t minimise relation key count<a class="anchor" aria-label="anchor" href="#synthesis-doesnt-minimise-relation-key-count"></a>
</h2>
<p>Bernstein’s synthesis is guaranteed to minimise the number of
relations created for a given set of functional dependencies, and
removing avoidable attributes can reduce the number of attributes in
those relations. However, there can still be redundant keys. For
example, we can take the following set of functional dependencies:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fds_redkey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"d"</span><span class="op">)</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fds_redkey</span></span></code></pre></div>
<pre><code><span><span class="co">## 5 functional dependencies</span></span>
<span><span class="co">## 4 attributes: a, b, c, d</span></span>
<span><span class="co">##    a -&gt; b</span></span>
<span><span class="co">##    d -&gt; c</span></span>
<span><span class="co">## b, d -&gt; a</span></span>
<span><span class="co">##    a -&gt; c</span></span>
<span><span class="co">## b, c -&gt; d</span></span></code></pre>
<p>Normalising gives the following relations:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema_redkey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">fds_redkey</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">schema_redkey</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">d<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_d -> \"d\":TO_d;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>These relations have some redundancy: relation <code>a</code> implies
<code>{b, d} -&gt; c</code>, but relation <code>d</code> implies that
<code>{d} -&gt; c</code>. This isn’t resolved by removing avoidable
attributes, because <code>d</code> still needs to be in relation
<code>a</code>: we just need to remove <code>{b, d}</code> as a key.
However, this is resolved if we instead use this set of functional
dependencies, which is equivalent to the previous set:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fds_redkey_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"c"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fds_redkey_fix</span></span></code></pre></div>
<pre><code><span><span class="co">## 4 functional dependencies</span></span>
<span><span class="co">## 4 attributes: a, b, c, d</span></span>
<span><span class="co">##    a -&gt; b</span></span>
<span><span class="co">##    d -&gt; c</span></span>
<span><span class="co">## b, c -&gt; a</span></span>
<span><span class="co">##    a -&gt; d</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema_redkey_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">fds_redkey_fix</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">schema_redkey_fix</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"a\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">a<\/TD><\/TR>\n    <TR><TD PORT=\"TO_a\">a<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_a\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_b\">b<\/TD><TD><\/TD><TD PORT=\"FROM_b\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD><\/TD><TD PORT=\"FROM_c\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD><\/TD><TD PORT=\"FROM_d\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"d\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">d<\/TD><\/TR>\n    <TR><TD PORT=\"TO_d\">d<\/TD><TD PORT=\"FROM_d\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_c\">c<\/TD><TD PORT=\"FROM_c\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"a\":FROM_d -> \"d\":TO_d;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Unfortunately, there’s no way in the package to find better sets like
this.</p>
</div>
<div class="section level2">
<h2 id="normal-forms-aret-all-there-is-to-database-design">Normal forms are’t all there is to database design<a class="anchor" aria-label="anchor" href="#normal-forms-aret-all-there-is-to-database-design"></a>
</h2>
<p>Normal forms only refer to one relation at a time: referring to a
database as being in a given normal form just means that each if its
relations are in it individually. This doesn’t address the addition of
foreign key references, but, even if the references are sensible,
schemas that are in higher normal forms may not be ones that we’d want
to use.</p>
<p>For example, take this database schema, whose relation schemas are in
third normal form:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dup_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">dup_db</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-1fb4450895fe099f74a1" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Chick (50 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_diet\">Diet<\/TD><TD><\/TD><TD PORT=\"FROM_diet\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"Time_Chick\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">Time_Chick (578 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_time\">Time<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_time\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_chick\">Chick<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_chick\">ordered<\/TD><\/TR>\n    <TR><TD PORT=\"TO_weight\">weight<\/TD><TD><\/TD><TD PORT=\"FROM_weight\">numeric<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"Time_Chick\":FROM_chick -> \"Chick\":TO_chick;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>If we now create copies of these relations, with the intention that
copies always contain the same data, then all relations are still in
third normal form, and so we’d say this database is also in third normal
form:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">dup_db</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>However, no one would claim that this is a good database design,
since there is clearly a large amount of data redundancy. Higher normal
forms would not change this. In fact, since the copies do not reference
each other, it is also trivial to insert data to make this database
incoherent. For example, <code>Chick</code> and <code>Chick.1</code>
could contain different diet assignments.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Webster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
