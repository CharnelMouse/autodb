<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Handling missing values in autodb • autodb</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Handling missing values in autodb">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">autodb</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.3.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/autodb.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/autodb_limits.html">autodb limitations</a></li>
    <li><a class="dropdown-item" href="../articles/autodb_na.html">Handling missing values in autodb</a></li>
    <li><a class="dropdown-item" href="../articles/autodb_plan.html">Planned improvements for autodb</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CharnelMouse/autodb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Handling missing values in autodb</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CharnelMouse/autodb/blob/master/vignettes/autodb_na.Rmd" class="external-link"><code>vignettes/autodb_na.Rmd</code></a></small>
      <div class="d-none name"><code>autodb_na.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://charnelmouse.github.io/autodb/">autodb</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'autodb'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     decompose</span></span></code></pre></div>
<div class="section level2">
<h2 id="missing-values">Missing values<a class="anchor" aria-label="anchor" href="#missing-values"></a>
</h2>
<p>Strictly speaking, <code>autodb</code> does not search for functional
dependencies, because these can’t account for missing values. Instead,
it searches for a weaker variant, which has been called a
<em>literal</em> functional dependency (LFD) in the literature.</p>
<p>The functional dependency <code>X -&gt; Y</code> holds if, for any
two possible records whose values in <code>X</code> are <em>equal</em>,
their values in <code>Y</code> are also <em>equal</em>. This requires
attribute values to take the <em>equality</em> operator, <code>==</code>
in R. Additionally, they must take it under binary logic: whether two
values are equal can only be true or false, not missing. This disallows
the presence of missing values (<code>NA</code> and <code>NaN</code>),
since testing for equality with a missing value returns a missing
result.</p>
<p>The literal functional dependency <code>X -&gt; Y</code> holds, or
the functional dependency <code>X -&gt; Y</code> holds literally, if,
for any two possible records whose values in <code>X</code> are
<em>identical</em>, their values in <code>Y</code> are also
<em>identical</em>, where values are identical if both are non-missing
and equal, or both are missing. In other words, missing values are
treated as not equal to non-missing values, but as equal to each other.
This requires attribute classes to take the <em>identity</em> operator,
<code><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical()</a></code> with default optional parameter values in R.
Again, they must take it under binary logic, but the identity operator
cannot return non-binary results anyway: In R, for example,
<code><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical()</a></code> can only return <code>TRUE</code> or
<code>FALSE</code>, never <code>NA</code>. There is, therefore, no
constraint on missing values in attribute classes, or on attribute
classes in general.</p>
<p>LFDs are more generic than standard functional dependencies: since
practically every class takes the identity operator, they practically
make no assumptions about the attribute classes present in a data
set.</p>
<p>There are other FD variants that handle missing values, but, unlike
most of them, LFDs still satisfy Armstrong’s axioms, allowing them to be
used in normalisation in the same way as normal FDs. For example, they
still respect transitivity: if X -&gt; Y and Y -&gt; Z literally, then X
-&gt; Z literally. This allows us to construct a database schema with
Bernstein synthesis as usual, with LFDs instead of FDs, and still get
something coherent.</p>
<p>However, ignoring the special status of missing values in this way
ignores important structural information. In the relational model, and
ideally in relational databases, we want to have no missing values at
all, partly to avoid awkward questions about what trinary logic means
with respect to filtering or joining tables. For example, take the
following data frame:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_nas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  patient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">3L</span>, <span class="fl">4L</span><span class="op">)</span>,</span>
<span>  trial_entry_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2022/05/02"</span>, <span class="st">"2022/06/06"</span>, <span class="st">"2022/04/01"</span>, <span class="st">"2022/03/19"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trial_exit_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"2022/10/07"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_nas</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">patient</th>
<th align="left">trial_entry_date</th>
<th align="left">trial_exit_date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2022-05-02</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2022-06-06</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">2022-04-01</td>
<td align="left">2022-10-07</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">2022-03-19</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p><code>autodb</code> currently treats <code>NA</code> as just another
value, which results in the initial data frame not being split in the
database schema:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">df_nas</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; database with 1 relation</span></span>
<span><span class="co">#&gt; 3 attributes: patient, trial_entry_date, trial_exit_date</span></span>
<span><span class="co">#&gt; relation patient: patient, trial_entry_date, trial_exit_date; 4 records</span></span>
<span><span class="co">#&gt;   key 1: patient</span></span>
<span><span class="co">#&gt;   key 2: trial_entry_date</span></span>
<span><span class="co">#&gt; no references</span></span></code></pre></div>
<p>In this case, a missing exit date represents no exit date, i.e. that
the patient is still in the trail, and we would prefer to move exit
information to a separate relation, containing only patients with a exit
date:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ideal_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span></span>
<span>  <span class="va">df_nas</span>,</span>
<span>  <span class="fu"><a href="../reference/database_schema.html">database_schema</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/relation_schema.html">relation_schema</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        patient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="st">"trial_entry_date"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"patient"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        patient_exit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="st">"trial_exit_date"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"patient"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_nas</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"patient_exit"</span>, <span class="st">"patient"</span>, <span class="st">"patient"</span>, <span class="st">"patient"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">ideal_db</span><span class="op">)</span><span class="op">$</span><span class="va">patient_exit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">ideal_db</span><span class="op">)</span><span class="op">$</span><span class="va">patient_exit</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trial_exit_date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">ideal_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; database with 2 relations</span></span>
<span><span class="co">#&gt; 3 attributes: patient, trial_entry_date, trial_exit_date</span></span>
<span><span class="co">#&gt; relation patient: patient, trial_entry_date; 4 records</span></span>
<span><span class="co">#&gt;   key 1: patient</span></span>
<span><span class="co">#&gt; relation patient_exit: patient, trial_exit_date; 1 record</span></span>
<span><span class="co">#&gt;   key 1: patient</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; patient_exit.{patient} -&gt; patient.{patient}</span></span></code></pre></div>
<p>This makes more of the data’s structure apparent, and enforceable, in
the database structure, since it makes it clear that the death date is
optional. However, removing missing values in this way isn’t handled by
<code>autodb</code> itself, so it has to be done by manually creating
the schema and inserting/removing records, as shown above.</p>
</div>
<div class="section level2">
<h2 id="structure-conditional-on-value-presence">Structure conditional on value presence<a class="anchor" aria-label="anchor" href="#structure-conditional-on-value-presence"></a>
</h2>
<p>Sometimes, the structure for some attributes depends on whether other
attributes are missing. Here are two possible reasons:</p>
<ul>
<li>Some piece of information in a record takes one of several possible
formats, which may have different data classes. This leaves the single
piece of information spread across multiple sets of attributes, not
necessarily disjoint, of which only one set is non-missing per record.
In more general programming, this would be referred to as a union type.
In relational theory, this is called a disjunctive existence union.</li>
<li>A set of attributes are missing or non-missing together. In more
general programming, these attributes together represent an option type,
or a nullable class.</li>
<li>Sets of attributes are mutually exclusive. In more general
programming, these attributes together represent a discriminated union,
or sum type.</li>
</ul>
<p>For example, the data below records values, and allows them to be
single values, or an interval with an associated distribution, which may
have some distribution parameters. This format is common when listing
model parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.3</span>, <span class="fl">2.3</span>, <span class="fl">5.7</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span><span class="op">)</span>,</span>
<span>  lower_bound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="fl">2.4</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">5.6</span>, <span class="fl">2.4</span>, <span class="fl">5.3</span>, <span class="fl">5.3</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">2.4</span>, <span class="fl">5.6</span>, <span class="fl">2.4</span><span class="op">)</span>,</span>
<span>  upper_bound <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span>, <span class="fl">7.1</span>, <span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">13.1</span>, <span class="fl">25.8</span>, <span class="fl">10</span>, <span class="fl">13.1</span>, <span class="fl">10</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>,<span class="fl">13.1</span>, <span class="fl">13.1</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span>, <span class="fl">25.8</span><span class="op">)</span>,</span>
<span>  interval_distribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"uniform"</span>, <span class="st">"Beta"</span>, <span class="st">"Beta"</span>, <span class="st">"Beta"</span>, <span class="st">"Beta"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"Kumaraswamy"</span>, <span class="st">"PERT"</span>, <span class="st">"PERT"</span>, <span class="st">"PERT"</span>, <span class="st">"PERT"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  param1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2.1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  param2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df_options</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="8%">
<col width="17%">
<col width="17%">
<col width="31%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="right">value</th>
<th align="right">lower_bound</th>
<th align="right">upper_bound</th>
<th align="left">interval_distribution</th>
<th align="right">param1</th>
<th align="right">param2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">2.3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2.3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">5.7</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">7.1</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">NA</td>
<td align="right">0.0</td>
<td align="right">10.0</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">NA</td>
<td align="right">1.0</td>
<td align="right">10.0</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">NA</td>
<td align="right">0.0</td>
<td align="right">13.1</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">NA</td>
<td align="right">5.6</td>
<td align="right">25.8</td>
<td align="left">uniform</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">10.0</td>
<td align="left">Beta</td>
<td align="right">1.0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">NA</td>
<td align="right">5.3</td>
<td align="right">13.1</td>
<td align="left">Beta</td>
<td align="right">1.0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">NA</td>
<td align="right">5.3</td>
<td align="right">10.0</td>
<td align="left">Beta</td>
<td align="right">1.0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Beta</td>
<td align="right">2.0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">13.1</td>
<td align="left">Kumaraswamy</td>
<td align="right">2.0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">17</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">13.1</td>
<td align="left">PERT</td>
<td align="right">2.0</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">18</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">PERT</td>
<td align="right">1.0</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">NA</td>
<td align="right">5.6</td>
<td align="right">25.8</td>
<td align="left">PERT</td>
<td align="right">2.0</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">NA</td>
<td align="right">2.4</td>
<td align="right">25.8</td>
<td align="left">PERT</td>
<td align="right">2.0</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p><code>autodb</code> has no way to know about these relationships,
because it doesn’t treat missing values as a special case, as described
above. The resulting schema therefore ignores them:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">df_options</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db_options</span><span class="op">)</span></span>
<span><span class="co">#&gt; database with 1 relation</span></span>
<span><span class="co">#&gt; 7 attributes: id, value, lower_bound, upper_bound, interval_distribution, param1, param2</span></span>
<span><span class="co">#&gt; relation id: id, value, lower_bound, upper_bound, interval_distribution, param1, param2; 20 records</span></span>
<span><span class="co">#&gt;   key 1: id</span></span>
<span><span class="co">#&gt; no references</span></span></code></pre></div>
<p>However, from looking at the data ourselves, we can see a
clearly-implied structure:</p>
<ul>
<li>A record either has a perfectly-known value, or a distribution of
what the value could be. These two options have separate
attributes.</li>
<li>Distribution information contains a lower and upper bound, and a
distribution type. Different distributions have different numbers of
distribution parameters, which are given in shared parameter
attributes.</li>
<li>Parameter attributes are ordered: their value can only be
non-missing if all of the previous parameter values are
non-missing.</li>
</ul>
<p>As a general hack for finding these sorts of relationships, I like
taking each attribute with missing values, and adding a companion
attribute that states whether the value is present or missing:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_options_presence</span> <span class="op">&lt;-</span> <span class="va">df_options</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">df_options</span>, <span class="va">anyNA</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df_options_presence</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df_options_presence</span>, <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_options_presence</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_options_presence</span><span class="op">)</span>, <span class="st">"_present"</span><span class="op">)</span></span>
<span><span class="va">df_options_with_presence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_options</span>, <span class="va">df_options_presence</span><span class="op">)</span></span></code></pre></div>
<p>This is not always practical, because adding columns rapidly
increases the running time for the dependency search. However, when it’s
practical, it helps to make the structure more apparent in the database
schema:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_options_with_presence</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="va">df_options_with_presence</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db_options_with_presence</span><span class="op">)</span></span>
<span><span class="co">#&gt; database with 8 relations</span></span>
<span><span class="co">#&gt; 13 attributes: id, value, lower_bound, upper_bound, interval_distribution, param1, param2, value_present, lower_bound_present, upper_bound_present, interval_distribution_present, param1_present, param2_present</span></span>
<span><span class="co">#&gt; relation id: id, value, lower_bound, upper_bound, interval_distribution, param1, param2; 20 records</span></span>
<span><span class="co">#&gt;   key 1: id</span></span>
<span><span class="co">#&gt; relation value: value, value_present; 3 records</span></span>
<span><span class="co">#&gt;   key 1: value</span></span>
<span><span class="co">#&gt; relation lower_bound: lower_bound, value_present; 6 records</span></span>
<span><span class="co">#&gt;   key 1: lower_bound</span></span>
<span><span class="co">#&gt; relation upper_bound: upper_bound, value_present; 5 records</span></span>
<span><span class="co">#&gt;   key 1: upper_bound</span></span>
<span><span class="co">#&gt; relation interval_distribution: interval_distribution, value_present, param1_present, param2_present; 5 records</span></span>
<span><span class="co">#&gt;   key 1: interval_distribution</span></span>
<span><span class="co">#&gt; relation param1: param1, param1_present; 4 records</span></span>
<span><span class="co">#&gt;   key 1: param1</span></span>
<span><span class="co">#&gt; relation param2: param2, param2_present; 3 records</span></span>
<span><span class="co">#&gt;   key 1: param2</span></span>
<span><span class="co">#&gt; relation value_present: value_present, lower_bound_present, upper_bound_present, interval_distribution_present; 2 records</span></span>
<span><span class="co">#&gt;   key 1: value_present</span></span>
<span><span class="co">#&gt;   key 2: lower_bound_present</span></span>
<span><span class="co">#&gt;   key 3: upper_bound_present</span></span>
<span><span class="co">#&gt;   key 4: interval_distribution_present</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; id.{value} -&gt; value.{value}</span></span>
<span><span class="co">#&gt; id.{lower_bound} -&gt; lower_bound.{lower_bound}</span></span>
<span><span class="co">#&gt; id.{upper_bound} -&gt; upper_bound.{upper_bound}</span></span>
<span><span class="co">#&gt; id.{interval_distribution} -&gt; interval_distribution.{interval_distribution}</span></span>
<span><span class="co">#&gt; id.{param1} -&gt; param1.{param1}</span></span>
<span><span class="co">#&gt; id.{param2} -&gt; param2.{param2}</span></span>
<span><span class="co">#&gt; value.{value_present} -&gt; value_present.{value_present}</span></span>
<span><span class="co">#&gt; lower_bound.{value_present} -&gt; value_present.{value_present}</span></span>
<span><span class="co">#&gt; upper_bound.{value_present} -&gt; value_present.{value_present}</span></span>
<span><span class="co">#&gt; interval_distribution.{value_present} -&gt; value_present.{value_present}</span></span></code></pre></div>
<p>Some of the new relations just show that an attribute determines its
associated presence attribute, which is always true. Of more interest is
the <code>value_present</code> relation, which shows that the values,
bounds, and interval distributions inform the presence of each
other:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db_options_with_presence</span><span class="op">)</span><span class="op">$</span><span class="va">value_present</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="16%">
<col width="22%">
<col width="22%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">value_present</th>
<th align="left">lower_bound_present</th>
<th align="left">upper_bound_present</th>
<th align="left">interval_distribution_present</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<p>In the <code>interval_distribution</code> relation, we can also see
how the interval distribution determines how many parameters are
required:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db_options_with_presence</span><span class="op">)</span><span class="op">$</span><span class="va">interval_distribution</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="31%">
<col width="20%">
<col width="21%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">interval_distribution</th>
<th align="left">value_present</th>
<th align="left">param1_present</th>
<th align="left">param2_present</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">NA</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">uniform</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">Beta</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">13</td>
<td align="left">Kumaraswamy</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">17</td>
<td align="left">PERT</td>
<td align="left">FALSE</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>This shows addition structure, specifically an existence constraint:
if <code>param2</code> is present, then <code>param1</code> is also
present. If we notice a situation like this, we can attempt further
investigation by splitting the data, and passing each part into
<code>autodb</code> separately. Splitting on whether <code>param1</code>
is present, we get the following database for records where it is
absent:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db_options_with_presence_p1absent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">df_options_with_presence</span>,</span>
<span>  <span class="op">!</span><span class="va">param1_present</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">db_options_with_presence_p1absent</span><span class="op">)</span></span>
<span><span class="co">#&gt; database with 6 relations</span></span>
<span><span class="co">#&gt; 13 attributes: id, value, lower_bound, upper_bound, interval_distribution, param1, param2, value_present, lower_bound_present, upper_bound_present, interval_distribution_present, param1_present, param2_present</span></span>
<span><span class="co">#&gt; relation constants: param1, param2, param1_present, param2_present; 1 record</span></span>
<span><span class="co">#&gt;   key 1: </span></span>
<span><span class="co">#&gt; relation id: id, value, lower_bound, upper_bound; 8 records</span></span>
<span><span class="co">#&gt;   key 1: id</span></span>
<span><span class="co">#&gt; relation value: value, interval_distribution; 3 records</span></span>
<span><span class="co">#&gt;   key 1: value</span></span>
<span><span class="co">#&gt; relation lower_bound: lower_bound, interval_distribution; 5 records</span></span>
<span><span class="co">#&gt;   key 1: lower_bound</span></span>
<span><span class="co">#&gt; relation upper_bound: upper_bound, interval_distribution; 5 records</span></span>
<span><span class="co">#&gt;   key 1: upper_bound</span></span>
<span><span class="co">#&gt; relation interval_distribution: interval_distribution, value_present, lower_bound_present, upper_bound_present, interval_distribution_present; 2 records</span></span>
<span><span class="co">#&gt;   key 1: interval_distribution</span></span>
<span><span class="co">#&gt;   key 2: value_present</span></span>
<span><span class="co">#&gt;   key 3: lower_bound_present</span></span>
<span><span class="co">#&gt;   key 4: upper_bound_present</span></span>
<span><span class="co">#&gt;   key 5: interval_distribution_present</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; id.{value} -&gt; value.{value}</span></span>
<span><span class="co">#&gt; id.{lower_bound} -&gt; lower_bound.{lower_bound}</span></span>
<span><span class="co">#&gt; id.{upper_bound} -&gt; upper_bound.{upper_bound}</span></span>
<span><span class="co">#&gt; value.{interval_distribution} -&gt; interval_distribution.{interval_distribution}</span></span>
<span><span class="co">#&gt; lower_bound.{interval_distribution} -&gt; interval_distribution.{interval_distribution}</span></span>
<span><span class="co">#&gt; upper_bound.{interval_distribution} -&gt; interval_distribution.{interval_distribution}</span></span></code></pre></div>
<p>This only contains records for point estimates, or intervals with a
uniform distribution, so the distribution value is now equivalent to its
presence/absence, or that of the value and bounds. Due to the existence
constraint mentioned above, <code>param2</code> is constant, since it’s
always absent:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">db_options_with_presence_p1absent</span><span class="op">)</span><span class="op">$</span><span class="va">constants</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param1</th>
<th align="right">param2</th>
<th align="left">param1_present</th>
<th align="left">param2_present</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr></tbody>
</table>
<p>We get the following database for records where <code>param1</code>
is present:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/autodb.html">autodb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">df_options_with_presence</span>,</span>
<span>  <span class="va">param1_present</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; database with 4 relations</span></span>
<span><span class="co">#&gt; 13 attributes: id, value, lower_bound, upper_bound, interval_distribution, param1, param2, value_present, lower_bound_present, upper_bound_present, interval_distribution_present, param1_present, param2_present</span></span>
<span><span class="co">#&gt; relation constants: value, value_present, lower_bound_present, upper_bound_present, interval_distribution_present, param1_present; 1 record</span></span>
<span><span class="co">#&gt;   key 1: </span></span>
<span><span class="co">#&gt; relation id: id, lower_bound, upper_bound, interval_distribution, param1, param2; 12 records</span></span>
<span><span class="co">#&gt;   key 1: id</span></span>
<span><span class="co">#&gt;   key 2: lower_bound, upper_bound, interval_distribution, param1, param2</span></span>
<span><span class="co">#&gt; relation interval_distribution: interval_distribution, param2_present; 3 records</span></span>
<span><span class="co">#&gt;   key 1: interval_distribution</span></span>
<span><span class="co">#&gt; relation param2: param2, param2_present; 3 records</span></span>
<span><span class="co">#&gt;   key 1: param2</span></span>
<span><span class="co">#&gt; references:</span></span>
<span><span class="co">#&gt; id.{interval_distribution} -&gt; interval_distribution.{interval_distribution}</span></span>
<span><span class="co">#&gt; id.{param2} -&gt; param2.{param2}</span></span></code></pre></div>
<p>In this case, whether <code>param2</code> is present is determined by
the distribution used, as we’d expect.</p>
<p>Since this data splitting is currently a manual process, there are
practical limits to how far we can take this. In the future, I’d like to
have automating it as an option, but this could greatly increase the
required run time.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Webster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
