<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A larger example: the nudge dataset • autodb</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A larger example: the nudge dataset">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">autodb</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/autodb.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/limits.html">Limitations</a></li>
    <li><a class="dropdown-item" href="../articles/nudge.html">A larger example: the nudge dataset</a></li>
    <li><a class="dropdown-item" href="../articles/null.html">Handling missing values</a></li>
    <li><a class="dropdown-item" href="../articles/plans.html">Planned improvements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CharnelMouse/autodb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="nudge_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="nudge_files/viz-1.8.2/viz.js"></script><link href="nudge_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="nudge_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A larger example: the nudge dataset</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CharnelMouse/autodb/blob/master/vignettes/nudge.Rmd" class="external-link"><code>vignettes/nudge.Rmd</code></a></small>
      <div class="d-none name"><code>nudge.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://charnelmouse.github.io/autodb/">autodb</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'autodb'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     decompose</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"DiagrammeR"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rich-iannone.github.io/DiagrammeR/reference/grViz.html" class="external-link">grViz</a></span><span class="op">(</span><span class="fu"><a href="../reference/gv.html">gv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">show</span> <span class="op">&lt;-</span> <span class="va">print</span></span>
<span>  <span class="va">maybe_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Included in the package is a 447-by-25 data frame called
<code>nudge</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">nudge</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"digraph \"data\" {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"data\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">data (447 rows)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>This is the data set for a meta-analysis, looking at the
effectiveness of “nudge” interventions. Measurements are taken within a
three-layer hierarchy: publications contain studies, which contain
effect size measurements. We expect this hierarchy to be apparent in the
normalisation.</p>
<div class="section level2">
<h2 id="initial-decomposition">Initial decomposition<a class="anchor" aria-label="anchor" href="#initial-decomposition"></a>
</h2>
<p>Getting full dependency information for this relation can take a long
time, so here we search for a reduced set, not considering numeric or
sample size attributes as determinants:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge</span>,</span>
<span>  exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n_study"</span>, <span class="st">"n_comparison"</span>, <span class="st">"n_control"</span>, <span class="st">"n_intervention"</span><span class="op">)</span>,</span>
<span>  exclude_class <span class="op">=</span> <span class="st">"numeric"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nudge_schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">nudge_deps</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_location\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_location<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_domain\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_domain<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_domain\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">publication_id_intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"publication_id_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">publication_id_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference_binary_outcome\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_binary_outcome<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"reference_type_experiment\":FROM_reference -> \"reference\":TO_reference;\n  \"publication_id_location\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_location\":FROM_reference -> \"title\":TO_reference;\n  \"publication_id_domain\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_domain\":FROM_reference -> \"title\":TO_reference;\n  \"publication_id_intervention_technique\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_intervention_technique\":FROM_reference -> \"title\":TO_reference;\n  \"publication_id_type_experiment\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"publication_id_type_experiment\":FROM_reference -> \"title\":TO_reference;\n  \"reference_binary_outcome\":FROM_publication_id -> \"title\":TO_publication_id;\n  \"reference_binary_outcome\":FROM_reference -> \"title\":TO_reference;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"publication_id_intervention_technique\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_publication_id -> \"publication_id_domain\":TO_publication_id;\n  \"study_id\":FROM_domain -> \"publication_id_domain\":TO_domain;\n  \"study_id\":FROM_publication_id -> \"publication_id_type_experiment\":TO_publication_id;\n  \"study_id\":FROM_type_experiment -> \"publication_id_type_experiment\":TO_type_experiment;\n  \"publication_id_type_experiment\":FROM_reference -> \"reference_type_experiment\":TO_reference;\n  \"publication_id_type_experiment\":FROM_type_experiment -> \"reference_type_experiment\":TO_type_experiment;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We can see a relation, with many attributes, determined by the effect
size ID number, <code>es_id</code>. This contains all of the numeric
measurements, as expected in the relation for the lowest level in the
hierarchy. As also expected, this has a foreign key reference to a
relation for study-level information, determined by the study ID number,
<code>study_id</code>.</p>
<p>However, the publication-level relation this refers to is not
determined by the publication ID, <code>publication_id</code>, as we
would expect; neither is it determined by the publication reference.
Instead, it is solely determined by the publication’s title: to use the
ID, we would need to supplement it with other information, like the
publication year, or other choices that come from the middle column of
relations, which look likely to be spurious.</p>
<p>This suggests that some publication ID numbers have been erroneously
assigned to several publications, which we can easily test:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_database</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">nudge</span>, <span class="va">nudge_schema</span><span class="op">)</span></span>
<span><span class="va">nudge_title_relation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/records.html">records</a></span><span class="op">(</span><span class="va">nudge_database</span><span class="op">)</span><span class="op">$</span><span class="va">title</span></span>
<span><span class="va">nudge_pid_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">publication_id</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">publication_id</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">nudge_title_relation</span>, <span class="va">publication_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">nudge_pid_duplicates</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="3%">
<col width="62%">
<col width="12%">
<col width="17%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">title</th>
<th align="right">publication_id</th>
<th align="left">reference</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">44</td>
<td align="left">Enhanced active choice: A new method to motivate
behavior change</td>
<td align="right">95</td>
<td align="left">Keller et al. (2011)</td>
<td align="right">2011</td>
</tr>
<tr class="even">
<td align="left">130</td>
<td align="left">Nudging product choices: The effect of position change
on snack bar choice</td>
<td align="right">95</td>
<td align="left">Keller et al. (2015)</td>
<td align="right">2015</td>
</tr>
</tbody>
</table>
<p>We’d also expect <code>reference</code> to determine the publication,
but this is also not the case: it needs additional information, such as
<code>binary_outcome</code>.</p>
<p>This means that there are publications that share a reference:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_reference_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">reference</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">nudge_title_relation</span><span class="op">$</span><span class="va">reference</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">nudge_title_relation</span>, <span class="va">reference</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">nudge_reference_duplicates</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="72%">
<col width="11%">
<col width="9%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">title</th>
<th align="right">publication_id</th>
<th align="left">reference</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">214</td>
<td align="left">Nudge vs superbugs: A behavioural economics trial to
reduce the overprescribing of antibiotics</td>
<td align="right">18</td>
<td align="left">BETA (2018)</td>
<td align="right">2018</td>
</tr>
<tr class="even">
<td align="left">399</td>
<td align="left">Energy labels that make cents</td>
<td align="right">19</td>
<td align="left">BETA (2018)</td>
<td align="right">2018</td>
</tr>
</tbody>
</table>
<p>BETA is the Behavioural Economics Team of the Australian Government,
so it’s not surprising that they’d have multiple publications/reports
per year. Duplicate references is not necessarily an error, but would be
awkward if the references were to be used.</p>
<p>There are other, clearly spurious, relations involving
<code>reference</code>. One of these combines it with
<code>type_experiment</code> to determine <code>location</code>. Since
<code>reference</code> is a publication-level attribute, and
<code>location</code> is a study-level attribute, this can’t be
right.</p>
<p>(As far as I’m aware, the publication ID and reference errors
mentioned above would not have affected the meta-analysis results.)</p>
</div>
<div class="section level2">
<h2 id="removing-spurious-structure">Removing spurious structure<a class="anchor" aria-label="anchor" href="#removing-spurious-structure"></a>
</h2>
<p>The publication ID and the reference clearly have issues, so we need
to decide what to do about them. Here, I’ll show what is usually the
correct approach, which is to remove the spurious functional
dependencies. We’ll look at the other options later.</p>
<p>The better option is to remove all functional dependencies that we’d
consider to be spurious: those where publication ID or reference are
part of a multiple-attribute determinant set, and the determinant set
isn’t just those two:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps_filtered</span> <span class="op">&lt;-</span> <span class="va">nudge_deps</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="../reference/detset.html">detset</a></span><span class="op">(</span><span class="va">nudge_deps</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/detset.html">detset</a></span><span class="op">(</span><span class="va">nudge_deps</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">ds</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">ds</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"publication_id"</span>, <span class="st">"reference"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="va">nudge_schema_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">nudge_deps_filtered</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema_filtered</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_title -> \"title_type_experiment\":TO_title;\n  \"study_id\":FROM_type_experiment -> \"title_type_experiment\":TO_type_experiment;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>We now, finally, have the study location in a non-spurious relation.
If we want to, we could also add the dependencies we fail to find, due
to excluding the sample size attributes from determinant sets:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/discover.html">discover</a></span><span class="op">(</span><span class="va">nudge</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge</span><span class="op">)</span>, <span class="st">"n_"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">nudge_deps_size</span></span></code></pre></div>
<pre><code><span><span class="co">## 3 functional dependencies</span></span>
<span><span class="co">## 4 attributes: n_study, n_comparison, n_control, n_intervention</span></span>
<span><span class="co">##    n_control, n_intervention -&gt; n_comparison</span></span>
<span><span class="co">## n_comparison, n_intervention -&gt; n_control</span></span>
<span><span class="co">##      n_comparison, n_control -&gt; n_intervention</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_deps_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nudge_deps_filtered</span>, <span class="va">nudge_deps_size</span><span class="op">)</span></span>
<span><span class="va">nudge_schema_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">nudge_deps_final</span>, remove_avoidable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nudge_database_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose.html">decompose</a></span><span class="op">(</span><span class="va">nudge</span>, <span class="va">nudge_schema_final</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema_final</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"n_comparison_n_control\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">n_comparison_n_control<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_n_control\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_intervention\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_title -> \"title_type_experiment\":TO_title;\n  \"study_id\":FROM_type_experiment -> \"title_type_experiment\":TO_type_experiment;\n  \"es_id\":FROM_n_comparison -> \"n_comparison_n_control\":TO_n_comparison;\n  \"es_id\":FROM_n_control -> \"n_comparison_n_control\":TO_n_control;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The new schema confirms what we might expect, that the total sample
size, and the sizes of control and treatment arms, only have two degrees
of freedom: knowing two of them determines the other.</p>
<p>We’d expect this to be because the total sample size is the sum of
the other two. However, the functional dependency can’t determine this.
Indeed, if we check for this more specific condition, we find that it
doesn’t hold:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">nudge</span>,</span>
<span>  <span class="va">n_comparison</span> <span class="op">!=</span> <span class="va">n_control</span> <span class="op">+</span> <span class="va">n_intervention</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">es_id</span>,</span>
<span>    <span class="va">reference</span>,</span>
<span>    <span class="va">title</span>,</span>
<span>    <span class="va">n_study</span>,</span>
<span>    <span class="va">n_comparison</span>,</span>
<span>    <span class="va">n_control</span>,</span>
<span>    <span class="va">n_intervention</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="4%">
<col width="16%">
<col width="46%">
<col width="5%">
<col width="8%">
<col width="6%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">es_id</th>
<th align="left">reference</th>
<th align="left">title</th>
<th align="right">n_study</th>
<th align="right">n_comparison</th>
<th align="right">n_control</th>
<th align="right">n_intervention</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">237</td>
<td align="right">180</td>
<td align="left">Hedlin &amp; Sunstein (2016)</td>
<td align="left">Does active choosing promote green energy use?
Experimental evidence</td>
<td align="right">1037</td>
<td align="right">1037</td>
<td align="right">345</td>
<td align="right">346</td>
</tr>
<tr class="even">
<td align="left">302</td>
<td align="right">181</td>
<td align="left">Hedlin &amp; Sunstein (2016)</td>
<td align="left">Does active choosing promote green energy use?
Experimental evidence</td>
<td align="right">1037</td>
<td align="right">1037</td>
<td align="right">345</td>
<td align="right">346</td>
</tr>
</tbody>
</table>
<p>Looking through the paper, the arm sample sizes aren’t given
explicitly, but the numbers here are consistent with the parts of the
study that have two treatments.</p>
<p>Automatic search for functional dependencies cannot check
domain-specific constraints like the summation constraint above, but it
can give schemas that suggest constraints to check for, such as the
two-degrees relation above.</p>
<p>Going back to the final database schema, removing dependencies has
revealed extra information about study locations, via the new
<code>title_type_experiment</code> relation: studies of the same
experiment type in a publication always have the same location. Looking
at the resulting database shows that this removes many entries of what
would be redundant location information if kept in the study
relation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_database_final</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-1fb4450895fe099f74a1" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">study_id (334 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD><\/TD><TD PORT=\"FROM_domain\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD><\/TD><TD PORT=\"FROM_population\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD><\/TD><TD PORT=\"FROM_n_study\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD><\/TD><TD PORT=\"FROM_wansink\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">es_id (447 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_es_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD><\/TD><TD PORT=\"FROM_study_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD><\/TD><TD PORT=\"FROM_binary_outcome\">logical<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD><\/TD><TD PORT=\"FROM_mean_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD><\/TD><TD PORT=\"FROM_sd_control\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_mean_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD><\/TD><TD PORT=\"FROM_sd_intervention\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD><\/TD><TD PORT=\"FROM_cohens_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD><\/TD><TD PORT=\"FROM_variance_d\">numeric<\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD><\/TD><TD PORT=\"FROM_approximation\">logical<\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">reference (212 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD PORT=\"FROM_year\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">title (213 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\">character<\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">intervention_technique (9 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_intervention_technique\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD><\/TD><TD PORT=\"FROM_intervention_category\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"3\">title_type_experiment (231 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_title\">character<\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_type_experiment\">factor<\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD><\/TD><TD PORT=\"FROM_location\">factor<\/TD><\/TR>\n    <\/TABLE>>];\n  \"n_comparison_n_control\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"5\">n_comparison_n_control (346 records)<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_n_comparison\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_control\">integer<\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_n_intervention\">integer<\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n  \"study_id\":FROM_title -> \"title_type_experiment\":TO_title;\n  \"study_id\":FROM_type_experiment -> \"title_type_experiment\":TO_type_experiment;\n  \"es_id\":FROM_n_comparison -> \"n_comparison_n_control\":TO_n_comparison;\n  \"es_id\":FROM_n_control -> \"n_comparison_n_control\":TO_n_control;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>While this is not a dependency we could expect to hold if more data
was collected, it’s a reasonable dependency for the given data set,
which won’t be added to.</p>
</div>
<div class="section level2">
<h2 id="how-not-to-remove-spurious-structure">How not to remove spurious structure<a class="anchor" aria-label="anchor" href="#how-not-to-remove-spurious-structure"></a>
</h2>
<p>The additional relation mentioned at the end of the previous section
is also notable for what we’ll now discuss: alternative ways to get rid
of spurious structure. How can we do this?</p>
<ul>
<li>Remove the offending functional dependencies, and re-do the schema
creation (the proper method);</li>
<li>Remove offending attributes from the table –
e.g. <code>publication_id</code> above, since it doesn’t do its intended
job of unique publication identification – and re-do the entire process
(re-running <code>discover</code> can be expensive; we don’t always want
to throw out everything to do with an attribute,
e.g. <code>reference -&gt; year</code>, or
<code>title -&gt; reference</code>);</li>
<li>Add offending attributes to <code>exclude</code>, to disallow them
in determinant sets, and re-do the entire process (same issues as above,
except that we keep <code>title -&gt; reference</code>, since an
excluded <code>reference</code> can still be a dependant);</li>
<li>Remove offending schemas from the database schema / database (see
below).</li>
</ul>
<p>What happens if we remove the offending schemas?</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nudge_schema_relfiltered</span> <span class="op">&lt;-</span> <span class="va">nudge_schema</span><span class="op">[</span></span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"publication_id_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_publication_id"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"reference_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_reference"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nudge_schema</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>Subsetting a database schema also removes any foreign key references
involving removed schemas, so the resulting schema is still valid.
However, any foreign key reference chains with removed schemas in the
middle are broken. Amongst others, in this case we lose the reference
between the three relations for the three hierarchical data levels:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="va">nudge_schema_relfiltered</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-10b3b7155e8045a1b2ad" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"study_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">study_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD PORT=\"FROM_publication_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_domain\">domain<\/TD><TD PORT=\"FROM_domain\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_population\">population<\/TD><TD PORT=\"FROM_population\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_study\">n_study<\/TD><TD PORT=\"FROM_n_study\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_wansink\">wansink<\/TD><TD PORT=\"FROM_wansink\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"es_id\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">es_id<\/TD><\/TR>\n    <TR><TD PORT=\"TO_es_id\">es_id<\/TD><TD PORT=\"FROM_es_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_study_id\">study_id<\/TD><TD PORT=\"FROM_study_id\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_comparison\">n_comparison<\/TD><TD PORT=\"FROM_n_comparison\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_control\">n_control<\/TD><TD PORT=\"FROM_n_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_n_intervention\">n_intervention<\/TD><TD PORT=\"FROM_n_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_binary_outcome\">binary_outcome<\/TD><TD PORT=\"FROM_binary_outcome\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_control\">mean_control<\/TD><TD PORT=\"FROM_mean_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_control\">sd_control<\/TD><TD PORT=\"FROM_sd_control\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_mean_intervention\">mean_intervention<\/TD><TD PORT=\"FROM_mean_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_sd_intervention\">sd_intervention<\/TD><TD PORT=\"FROM_sd_intervention\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_cohens_d\">cohens_d<\/TD><TD PORT=\"FROM_cohens_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_variance_d\">variance_d<\/TD><TD PORT=\"FROM_variance_d\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_approximation\">approximation<\/TD><TD PORT=\"FROM_approximation\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD PORT=\"FROM_year\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"4\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD BGCOLOR=\"black\"><\/TD><TD><\/TD><TD PORT=\"FROM_title\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_publication_id\">publication_id<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_publication_id\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD><\/TD><TD BGCOLOR=\"black\"><\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_year\">year<\/TD><TD><\/TD><TD><\/TD><TD PORT=\"FROM_year\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"intervention_technique\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">intervention_technique<\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_technique\">intervention_technique<\/TD><TD PORT=\"FROM_intervention_technique\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_intervention_category\">intervention_category<\/TD><TD PORT=\"FROM_intervention_category\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"es_id\":FROM_study_id -> \"study_id\":TO_study_id;\n  \"title\":FROM_reference -> \"reference\":TO_reference;\n  \"es_id\":FROM_intervention_technique -> \"intervention_technique\":TO_intervention_technique;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Re-running <code>autoref</code> has no effect, because the
<code>es_id</code> section doesn’t contain any key for the
<code>title</code> section:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="../reference/autoref.html">autoref</a></span><span class="op">(</span><span class="va">nudge_schema_relfiltered</span><span class="op">)</span>, <span class="va">nudge_schema_relfiltered</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Because the database subschema including the <code>es_id</code>
relation only has <code>publication_id</code> for distinguishing
publications, effect sizes for the two publications with the same ID
cannot be uniquely associated with their publication: removing schemas
irreversibly separates two parts of the database schema.</p>
<p>Furthermore, compared to <code>nudge_schema_filtered</code>, there is
a relation schema missing: directly removing schemas loses the structure
information that results in the <code>title_type_experiment</code>
relation. How does this happen?</p>
<p>The relation isn’t present in the original schema,
<code>nudge_schema_filtered</code>, because the full set of functional
dependencies make its implied dependency transitive. Specifically,
<code>nudge_fds</code> contains the following functional
dependencies:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_fds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/functional_dependency.html">functional_dependency</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"reference"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reference"</span>, <span class="st">"type_experiment"</span><span class="op">)</span>, <span class="st">"location"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"type_experiment"</span><span class="op">)</span>, <span class="st">"location"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"reference"</span>, <span class="st">"type_experiment"</span>, <span class="st">"location"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">example_fds</span></span></code></pre></div>
<pre><code><span><span class="co">## 3 functional dependencies</span></span>
<span><span class="co">## 4 attributes: title, reference, type_experiment, location</span></span>
<span><span class="co">##                      title -&gt; reference</span></span>
<span><span class="co">## reference, type_experiment -&gt; location</span></span>
<span><span class="co">##     title, type_experiment -&gt; location</span></span></code></pre>
<p>The first two dependencies make the third transitive, so it’s ignored
when constructing the relation schemas: it’s implied, and enforced, by
the <code>title</code> and <code>reference_type_experiment</code>
relation schemas.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">example_fds</span>, ensure_lossless <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-4018eef1a407a0df6b52" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4018eef1a407a0df6b52">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"reference_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">reference_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>However, when <code>reference, type_experiment -&gt; location</code>
is removed as spurious,
<code>title, type_experiment -&gt; location</code> is no longer
transitive, so it now appears as its own relation schema.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">example_fds</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span>, ensure_lossless <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">show</span><span class="op">(</span><span class="fu"><a href="../reference/normalise.html">normalise</a></span><span class="op">(</span><span class="va">example_fds</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span>, ensure_lossless <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-5b1b2f4ad92281566982" style="width:100%;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5b1b2f4ad92281566982">{"x":{"diagram":"digraph {\n  rankdir = \"LR\"\n  node [shape=plaintext];\n\n  \"title\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_reference\">reference<\/TD><TD PORT=\"FROM_reference\"><\/TD><\/TR>\n    <\/TABLE>>];\n  \"title_type_experiment\" [label = <\n    <TABLE BORDER=\"0\" CELLBORDER=\"1\" CELLSPACING=\"0\" CELLPADDING=\"4\">\n    <TR><TD COLSPAN=\"2\">title_type_experiment<\/TD><\/TR>\n    <TR><TD PORT=\"TO_title\">title<\/TD><TD PORT=\"FROM_title\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_type_experiment\">type_experiment<\/TD><TD PORT=\"FROM_type_experiment\" BGCOLOR=\"black\"><\/TD><\/TR>\n    <TR><TD PORT=\"TO_location\">location<\/TD><TD PORT=\"FROM_location\"><\/TD><\/TR>\n    <\/TABLE>>];\n\n  \"title_type_experiment\":FROM_title -> \"title\":TO_title;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>When we instead remove the <code>reference_type_experiment</code>
schema, this implicitly also throws away the
<code>title, type_experiment -&gt; location</code> dependency that it
co-implies. We throw away non-spurious information that we don’t intend
to.</p>
<p>Between the risk of irreversibly breaking the database schema’s
structure, and the risk of unintentionally removing additional structure
information, I hope it’s clear why directly removing relations should be
avoided.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Webster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
